(function(){var t={9662:function(t,e,n){var i=n(7854),r=n(614),s=n(6330),o=i.TypeError;t.exports=function(t){if(r(t))return t;throw o(s(t)+" is not a function")}},6077:function(t,e,n){var i=n(7854),r=n(614),s=i.String,o=i.TypeError;t.exports=function(t){if("object"==typeof t||r(t))return t;throw o("Can't set "+s(t)+" as a prototype")}},5787:function(t,e,n){var i=n(7854),r=n(7976),s=i.TypeError;t.exports=function(t,e){if(r(e,t))return t;throw s("Incorrect invocation")}},9670:function(t,e,n){var i=n(7854),r=n(111),s=i.String,o=i.TypeError;t.exports=function(t){if(r(t))return t;throw o(s(t)+" is not an object")}},1318:function(t,e,n){var i=n(5656),r=n(1400),s=n(6244),o=function(t){return function(e,n,o){var a,c=i(e),l=s(c),u=r(o,l);if(t&&n!=n){while(l>u)if(a=c[u++],a!=a)return!0}else for(;l>u;u++)if((t||u in c)&&c[u]===n)return t||u||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},4326:function(t,e,n){var i=n(1702),r=i({}.toString),s=i("".slice);t.exports=function(t){return s(r(t),8,-1)}},648:function(t,e,n){var i=n(7854),r=n(1694),s=n(614),o=n(4326),a=n(5112),c=a("toStringTag"),l=i.Object,u="Arguments"==o(function(){return arguments}()),d=function(t,e){try{return t[e]}catch(n){}};t.exports=r?o:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=d(e=l(t),c))?n:u?o(e):"Object"==(i=o(e))&&s(e.callee)?"Arguments":i}},7741:function(t,e,n){var i=n(1702),r=Error,s=i("".replace),o=function(t){return String(r(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,c=a.test(o);t.exports=function(t,e){if(c&&"string"==typeof t&&!r.prepareStackTrace)while(e--)t=s(t,a,"");return t}},9920:function(t,e,n){var i=n(2597),r=n(3887),s=n(1236),o=n(3070);t.exports=function(t,e,n){for(var a=r(e),c=o.f,l=s.f,u=0;u<a.length;u++){var d=a[u];i(t,d)||n&&i(n,d)||c(t,d,l(e,d))}}},8880:function(t,e,n){var i=n(9781),r=n(3070),s=n(9114);t.exports=i?function(t,e,n){return r.f(t,e,s(1,n))}:function(t,e,n){return t[e]=n,t}},9114:function(t){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},9781:function(t,e,n){var i=n(7293);t.exports=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},317:function(t,e,n){var i=n(7854),r=n(111),s=i.document,o=r(s)&&r(s.createElement);t.exports=function(t){return o?s.createElement(t):{}}},3678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8113:function(t,e,n){var i=n(5005);t.exports=i("navigator","userAgent")||""},7392:function(t,e,n){var i,r,s=n(7854),o=n(8113),a=s.process,c=s.Deno,l=a&&a.versions||c&&c.version,u=l&&l.v8;u&&(i=u.split("."),r=i[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&o&&(i=o.match(/Edge\/(\d+)/),(!i||i[1]>=74)&&(i=o.match(/Chrome\/(\d+)/),i&&(r=+i[1]))),t.exports=r},748:function(t){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2914:function(t,e,n){var i=n(7293),r=n(9114);t.exports=!i((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",r(1,7)),7!==t.stack)}))},2109:function(t,e,n){var i=n(7854),r=n(1236).f,s=n(8880),o=n(1320),a=n(3505),c=n(9920),l=n(4705);t.exports=function(t,e){var n,u,d,h,f,p,m=t.target,v=t.global,b=t.stat;if(u=v?i:b?i[m]||a(m,{}):(i[m]||{}).prototype,u)for(d in e){if(f=e[d],t.noTargetGet?(p=r(u,d),h=p&&p.value):h=u[d],n=l(v?d:m+(b?".":"#")+d,t.forced),!n&&void 0!==h){if(typeof f==typeof h)continue;c(f,h)}(t.sham||h&&h.sham)&&s(f,"sham",!0),o(u,d,f,t)}}},7293:function(t){t.exports=function(t){try{return!!t()}catch(e){return!0}}},2104:function(t,e,n){var i=n(4374),r=Function.prototype,s=r.apply,o=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?o.bind(s):function(){return o.apply(s,arguments)})},4374:function(t,e,n){var i=n(7293);t.exports=!i((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},6916:function(t,e,n){var i=n(4374),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}},6530:function(t,e,n){var i=n(9781),r=n(2597),s=Function.prototype,o=i&&Object.getOwnPropertyDescriptor,a=r(s,"name"),c=a&&"something"===function(){}.name,l=a&&(!i||i&&o(s,"name").configurable);t.exports={EXISTS:a,PROPER:c,CONFIGURABLE:l}},1702:function(t,e,n){var i=n(4374),r=Function.prototype,s=r.bind,o=r.call,a=i&&s.bind(o,o);t.exports=i?function(t){return t&&a(t)}:function(t){return t&&function(){return o.apply(t,arguments)}}},5005:function(t,e,n){var i=n(7854),r=n(614),s=function(t){return r(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?s(i[t]):i[t]&&i[t][e]}},8173:function(t,e,n){var i=n(9662);t.exports=function(t,e){var n=t[e];return null==n?void 0:i(n)}},7854:function(t,e,n){var i=function(t){return t&&t.Math==Math&&t};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},2597:function(t,e,n){var i=n(1702),r=n(7908),s=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return s(r(t),e)}},3501:function(t){t.exports={}},4664:function(t,e,n){var i=n(9781),r=n(7293),s=n(317);t.exports=!i&&!r((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},8361:function(t,e,n){var i=n(7854),r=n(1702),s=n(7293),o=n(4326),a=i.Object,c=r("".split);t.exports=s((function(){return!a("z").propertyIsEnumerable(0)}))?function(t){return"String"==o(t)?c(t,""):a(t)}:a},9587:function(t,e,n){var i=n(614),r=n(111),s=n(7674);t.exports=function(t,e,n){var o,a;return s&&i(o=e.constructor)&&o!==n&&r(a=o.prototype)&&a!==n.prototype&&s(t,a),t}},2788:function(t,e,n){var i=n(1702),r=n(614),s=n(5465),o=i(Function.toString);r(s.inspectSource)||(s.inspectSource=function(t){return o(t)}),t.exports=s.inspectSource},8340:function(t,e,n){var i=n(111),r=n(8880);t.exports=function(t,e){i(e)&&"cause"in e&&r(t,"cause",e.cause)}},9909:function(t,e,n){var i,r,s,o=n(8536),a=n(7854),c=n(1702),l=n(111),u=n(8880),d=n(2597),h=n(5465),f=n(6200),p=n(3501),m="Object already initialized",v=a.TypeError,b=a.WeakMap,w=function(t){return s(t)?r(t):i(t,{})},g=function(t){return function(e){var n;if(!l(e)||(n=r(e)).type!==t)throw v("Incompatible receiver, "+t+" required");return n}};if(o||h.state){var y=h.state||(h.state=new b),_=c(y.get),k=c(y.has),E=c(y.set);i=function(t,e){if(k(y,t))throw new v(m);return e.facade=t,E(y,t,e),e},r=function(t){return _(y,t)||{}},s=function(t){return k(y,t)}}else{var x=f("state");p[x]=!0,i=function(t,e){if(d(t,x))throw new v(m);return e.facade=t,u(t,x,e),e},r=function(t){return d(t,x)?t[x]:{}},s=function(t){return d(t,x)}}t.exports={set:i,get:r,has:s,enforce:w,getterFor:g}},614:function(t){t.exports=function(t){return"function"==typeof t}},4705:function(t,e,n){var i=n(7293),r=n(614),s=/#|\.prototype\./,o=function(t,e){var n=c[a(t)];return n==u||n!=l&&(r(e)?i(e):!!e)},a=o.normalize=function(t){return String(t).replace(s,".").toLowerCase()},c=o.data={},l=o.NATIVE="N",u=o.POLYFILL="P";t.exports=o},111:function(t,e,n){var i=n(614);t.exports=function(t){return"object"==typeof t?null!==t:i(t)}},1913:function(t){t.exports=!1},2190:function(t,e,n){var i=n(7854),r=n(5005),s=n(614),o=n(7976),a=n(3307),c=i.Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return s(e)&&o(e.prototype,c(t))}},6244:function(t,e,n){var i=n(7466);t.exports=function(t){return i(t.length)}},133:function(t,e,n){var i=n(7392),r=n(7293);t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&i&&i<41}))},8536:function(t,e,n){var i=n(7854),r=n(614),s=n(2788),o=i.WeakMap;t.exports=r(o)&&/native code/.test(s(o))},6277:function(t,e,n){var i=n(1340);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:i(t)}},3070:function(t,e,n){var i=n(7854),r=n(9781),s=n(4664),o=n(3353),a=n(9670),c=n(4948),l=i.TypeError,u=Object.defineProperty,d=Object.getOwnPropertyDescriptor,h="enumerable",f="configurable",p="writable";e.f=r?o?function(t,e,n){if(a(t),e=c(e),a(n),"function"===typeof t&&"prototype"===e&&"value"in n&&p in n&&!n[p]){var i=d(t,e);i&&i[p]&&(t[e]=n.value,n={configurable:f in n?n[f]:i[f],enumerable:h in n?n[h]:i[h],writable:!1})}return u(t,e,n)}:u:function(t,e,n){if(a(t),e=c(e),a(n),s)try{return u(t,e,n)}catch(i){}if("get"in n||"set"in n)throw l("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},1236:function(t,e,n){var i=n(9781),r=n(6916),s=n(5296),o=n(9114),a=n(5656),c=n(4948),l=n(2597),u=n(4664),d=Object.getOwnPropertyDescriptor;e.f=i?d:function(t,e){if(t=a(t),e=c(e),u)try{return d(t,e)}catch(n){}if(l(t,e))return o(!r(s.f,t,e),t[e])}},8006:function(t,e,n){var i=n(6324),r=n(748),s=r.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,s)}},5181:function(t,e){e.f=Object.getOwnPropertySymbols},7976:function(t,e,n){var i=n(1702);t.exports=i({}.isPrototypeOf)},6324:function(t,e,n){var i=n(1702),r=n(2597),s=n(5656),o=n(1318).indexOf,a=n(3501),c=i([].push);t.exports=function(t,e){var n,i=s(t),l=0,u=[];for(n in i)!r(a,n)&&r(i,n)&&c(u,n);while(e.length>l)r(i,n=e[l++])&&(~o(u,n)||c(u,n));return u}},5296:function(t,e){"use strict";var n={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!n.call({1:2},1);e.f=r?function(t){var e=i(this,t);return!!e&&e.enumerable}:n},7674:function(t,e,n){var i=n(1702),r=n(9670),s=n(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=i(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set),t(n,[]),e=n instanceof Array}catch(o){}return function(n,i){return r(n),s(i),e?t(n,i):n.__proto__=i,n}}():void 0)},2140:function(t,e,n){var i=n(7854),r=n(6916),s=n(614),o=n(111),a=i.TypeError;t.exports=function(t,e){var n,i;if("string"===e&&s(n=t.toString)&&!o(i=r(n,t)))return i;if(s(n=t.valueOf)&&!o(i=r(n,t)))return i;if("string"!==e&&s(n=t.toString)&&!o(i=r(n,t)))return i;throw a("Can't convert object to primitive value")}},3887:function(t,e,n){var i=n(5005),r=n(1702),s=n(8006),o=n(5181),a=n(9670),c=r([].concat);t.exports=i("Reflect","ownKeys")||function(t){var e=s.f(a(t)),n=o.f;return n?c(e,n(t)):e}},2626:function(t,e,n){var i=n(3070).f;t.exports=function(t,e,n){n in t||i(t,n,{configurable:!0,get:function(){return e[n]},set:function(t){e[n]=t}})}},1320:function(t,e,n){var i=n(7854),r=n(614),s=n(2597),o=n(8880),a=n(3505),c=n(2788),l=n(9909),u=n(6530).CONFIGURABLE,d=l.get,h=l.enforce,f=String(String).split("String");(t.exports=function(t,e,n,c){var l,d=!!c&&!!c.unsafe,p=!!c&&!!c.enumerable,m=!!c&&!!c.noTargetGet,v=c&&void 0!==c.name?c.name:e;r(n)&&("Symbol("===String(v).slice(0,7)&&(v="["+String(v).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!s(n,"name")||u&&n.name!==v)&&o(n,"name",v),l=h(n),l.source||(l.source=f.join("string"==typeof v?v:""))),t!==i?(d?!m&&t[e]&&(p=!0):delete t[e],p?t[e]=n:o(t,e,n)):p?t[e]=n:a(e,n)})(Function.prototype,"toString",(function(){return r(this)&&d(this).source||c(this)}))},4488:function(t,e,n){var i=n(7854),r=i.TypeError;t.exports=function(t){if(void 0==t)throw r("Can't call method on "+t);return t}},3505:function(t,e,n){var i=n(7854),r=Object.defineProperty;t.exports=function(t,e){try{r(i,t,{value:e,configurable:!0,writable:!0})}catch(n){i[t]=e}return e}},6200:function(t,e,n){var i=n(2309),r=n(9711),s=i("keys");t.exports=function(t){return s[t]||(s[t]=r(t))}},5465:function(t,e,n){var i=n(7854),r=n(3505),s="__core-js_shared__",o=i[s]||r(s,{});t.exports=o},2309:function(t,e,n){var i=n(1913),r=n(5465);(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.22.2",mode:i?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.22.2/LICENSE",source:"https://github.com/zloirock/core-js"})},1400:function(t,e,n){var i=n(9303),r=Math.max,s=Math.min;t.exports=function(t,e){var n=i(t);return n<0?r(n+e,0):s(n,e)}},5656:function(t,e,n){var i=n(8361),r=n(4488);t.exports=function(t){return i(r(t))}},9303:function(t){var e=Math.ceil,n=Math.floor;t.exports=function(t){var i=+t;return i!==i||0===i?0:(i>0?n:e)(i)}},7466:function(t,e,n){var i=n(9303),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},7908:function(t,e,n){var i=n(7854),r=n(4488),s=i.Object;t.exports=function(t){return s(r(t))}},7593:function(t,e,n){var i=n(7854),r=n(6916),s=n(111),o=n(2190),a=n(8173),c=n(2140),l=n(5112),u=i.TypeError,d=l("toPrimitive");t.exports=function(t,e){if(!s(t)||o(t))return t;var n,i=a(t,d);if(i){if(void 0===e&&(e="default"),n=r(i,t,e),!s(n)||o(n))return n;throw u("Can't convert object to primitive value")}return void 0===e&&(e="number"),c(t,e)}},4948:function(t,e,n){var i=n(7593),r=n(2190);t.exports=function(t){var e=i(t,"string");return r(e)?e:e+""}},1694:function(t,e,n){var i=n(5112),r=i("toStringTag"),s={};s[r]="z",t.exports="[object z]"===String(s)},1340:function(t,e,n){var i=n(7854),r=n(648),s=i.String;t.exports=function(t){if("Symbol"===r(t))throw TypeError("Cannot convert a Symbol value to a string");return s(t)}},6330:function(t,e,n){var i=n(7854),r=i.String;t.exports=function(t){try{return r(t)}catch(e){return"Object"}}},9711:function(t,e,n){var i=n(1702),r=0,s=Math.random(),o=i(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++r+s,36)}},3307:function(t,e,n){var i=n(133);t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:function(t,e,n){var i=n(9781),r=n(7293);t.exports=i&&r((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},5112:function(t,e,n){var i=n(7854),r=n(2309),s=n(2597),o=n(9711),a=n(133),c=n(3307),l=r("wks"),u=i.Symbol,d=u&&u["for"],h=c?u:u&&u.withoutSetter||o;t.exports=function(t){if(!s(l,t)||!a&&"string"!=typeof l[t]){var e="Symbol."+t;a&&s(u,t)?l[t]=u[t]:l[t]=c&&d?d(e):h(e)}return l[t]}},9191:function(t,e,n){"use strict";var i=n(5005),r=n(2597),s=n(8880),o=n(7976),a=n(7674),c=n(9920),l=n(2626),u=n(9587),d=n(6277),h=n(8340),f=n(7741),p=n(2914),m=n(9781),v=n(1913);t.exports=function(t,e,n,b){var w="stackTraceLimit",g=b?2:1,y=t.split("."),_=y[y.length-1],k=i.apply(null,y);if(k){var E=k.prototype;if(!v&&r(E,"cause")&&delete E.cause,!n)return k;var x=i("Error"),S=e((function(t,e){var n=d(b?e:t,void 0),i=b?new k(t):new k;return void 0!==n&&s(i,"message",n),p&&s(i,"stack",f(i.stack,2)),this&&o(E,this)&&u(i,this,S),arguments.length>g&&h(i,arguments[g]),i}));if(S.prototype=E,"Error"!==_?a?a(S,x):c(S,x,{name:!0}):m&&w in k&&(l(S,k,w),l(S,k,"prepareStackTrace")),c(S,k),!v)try{E.name!==_&&s(E,"name",_),E.constructor=S}catch(j){}return S}}},1703:function(t,e,n){var i=n(2109),r=n(7854),s=n(2104),o=n(9191),a="WebAssembly",c=r[a],l=7!==Error("e",{cause:7}).cause,u=function(t,e){var n={};n[t]=o(t,e,l),i({global:!0,forced:l},n)},d=function(t,e){if(c&&c[t]){var n={};n[t]=o(a+"."+t,e,l),i({target:a,stat:!0,forced:l},n)}};u("Error",(function(t){return function(e){return s(t,this,arguments)}})),u("EvalError",(function(t){return function(e){return s(t,this,arguments)}})),u("RangeError",(function(t){return function(e){return s(t,this,arguments)}})),u("ReferenceError",(function(t){return function(e){return s(t,this,arguments)}})),u("SyntaxError",(function(t){return function(e){return s(t,this,arguments)}})),u("TypeError",(function(t){return function(e){return s(t,this,arguments)}})),u("URIError",(function(t){return function(e){return s(t,this,arguments)}})),d("CompileError",(function(t){return function(e){return s(t,this,arguments)}})),d("LinkError",(function(t){return function(e){return s(t,this,arguments)}})),d("RuntimeError",(function(t){return function(e){return s(t,this,arguments)}}))},2801:function(t,e,n){"use strict";var i=n(2109),r=n(5005),s=n(9114),o=n(3070).f,a=n(2597),c=n(5787),l=n(9587),u=n(6277),d=n(3678),h=n(7741),f=n(1913),p="DOMException",m=r("Error"),v=r(p),b=function(){c(this,w);var t=arguments.length,e=u(t<1?void 0:arguments[0]),n=u(t<2?void 0:arguments[1],"Error"),i=new v(e,n),r=m(e);return r.name=p,o(i,"stack",s(1,h(r.stack,1))),l(i,this,b),i},w=b.prototype=v.prototype,g="stack"in m(p),y="stack"in new v(1,2),_=g&&!y;i({global:!0,forced:f||_},{DOMException:_?b:v});var k=r(p),E=k.prototype;if(E.constructor!==k)for(var x in f||o(E,"constructor",s(1,k)),d)if(a(d,x)){var S=d[x],j=S.s;a(k,j)||o(k,j,s(6,S.c))}},3483:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(...t){this._head=this._tail=null,this._length=0,t.length>0&&t.forEach((t=>{this.append(t)}))}*iterator(){let t=this._head;while(t)yield t.value,t=t.next}[Symbol.iterator](){return this.iterator()}get head(){return this._head?this._head.value:null}get tail(){return this._tail?this._tail.value:null}get length(){return this._length}insert(t,e,n=!1){if(n&&this.isDuplicate(t))return!1;let r=new i(t),s=this._head;if(!s)return!1;while(1){if(s.value===e)return r.next=s.next,r.prev=s,s.next=r,r.next?r.next.prev=r:this._tail=r,this._length++,!0;if(!s.next)return!1;s=s.next}}append(t,e=!1){if(e&&this.isDuplicate(t))return!1;let n=new i(t);return this._tail?(this._tail.next=n,n.prev=this._tail,this._tail=n):this._head=this._tail=n,this._length++,!0}prepend(t,e=!1){if(e&&this.isDuplicate(t))return!1;let n=new i(t);return this._head?(n.next=this._head,this._head.prev=n,this._head=n):this._head=this._tail=n,this._length++,!0}remove(t){let e=this._head;if(e){if(e.value===t)return this._head=e.next,this._head.prev=null,e.next=e.prev=null,this._length--,e.value;while(1){if(e.value===t)return e.next?(e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null):(e.prev.next=null,this._tail=e.prev,e.next=e.prev=null),this._length--,e.value;if(!e.next)return;e=e.next}}}removeHead(){let t=this._head;if(t)return this._head.next?(this._head.next.prev=null,this._head=this._head.next,t.next=t.prev=null):(this._head=null,this._tail=null),this._length--,t.value}removeTail(){let t=this._tail;if(t)return this._tail.prev?(this._tail.prev.next=null,this._tail=this._tail.prev,t.next=t.prev=null):(this._head=null,this._tail=null),this._length--,t.value}first(t){let e=this.iterator(),n=[],i=Math.min(t,this.length);for(let r=0;r<i;r++){let t=e.next();n.push(t.value)}return n}toArray(){return[...this]}isDuplicate(t){let e=new Set(this.toArray());return e.has(t)}}e.LinkedList=n;class i{constructor(t){this.value=t,this.next=null,this.prev=null}}e.LinkedListItem=i},4609:function(t,e,n){"use strict";const i=n(3483);class r extends i.LinkedList{constructor(...t){super(...t)}get front(){return this.head}enqueue(t){this.append(t)}dequeue(){return this.removeHead()}}e.c=r}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}!function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}();!function(){"use strict";n(1703);const t=Symbol("Comlink.proxy"),e=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.thrown"),s=t=>"object"===typeof t&&null!==t||"function"===typeof t,o={canHandle:e=>s(e)&&e[t],serialize(t){const{port1:e,port2:n}=new MessageChannel;return l(t,e),[n,[n]]},deserialize(t){return t.start(),h(t)}},a={canHandle:t=>s(t)&&r in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}},c=new Map([["proxy",o],["throw",a]]);function l(t,e=self){e.addEventListener("message",(function n(i){if(!i||!i.data)return;const{id:s,type:o,path:a}=Object.assign({path:[]},i.data),c=(i.data.argumentList||[]).map(_);let u;try{const e=a.slice(0,-1).reduce(((t,e)=>t[e]),t),n=a.reduce(((t,e)=>t[e]),t);switch(o){case"GET":u=n;break;case"SET":e[a.slice(-1)[0]]=_(i.data.value),u=!0;break;case"APPLY":u=n.apply(e,c);break;case"CONSTRUCT":{const t=new n(...c);u=g(t)}break;case"ENDPOINT":{const{port1:e,port2:n}=new MessageChannel;l(t,n),u=w(e,[e])}break;case"RELEASE":u=void 0;break;default:return}}catch(h){u={value:h,[r]:0}}Promise.resolve(u).catch((t=>({value:t,[r]:0}))).then((t=>{const[i,r]=y(t);e.postMessage(Object.assign(Object.assign({},i),{id:s}),r),"RELEASE"===o&&(e.removeEventListener("message",n),d(e))}))})),e.start&&e.start()}function u(t){return"MessagePort"===t.constructor.name}function d(t){u(t)&&t.close()}function h(t,e){return p(t,[],e)}function f(t){if(t)throw new Error("Proxy has been released and is not useable")}function p(t,n=[],r=function(){}){let s=!1;const o=new Proxy(r,{get(e,r){if(f(s),r===i)return()=>k(t,{type:"RELEASE",path:n.map((t=>t.toString()))}).then((()=>{d(t),s=!0}));if("then"===r){if(0===n.length)return{then:()=>o};const e=k(t,{type:"GET",path:n.map((t=>t.toString()))}).then(_);return e.then.bind(e)}return p(t,[...n,r])},set(e,i,r){f(s);const[o,a]=y(r);return k(t,{type:"SET",path:[...n,i].map((t=>t.toString())),value:o},a).then(_)},apply(i,r,o){f(s);const a=n[n.length-1];if(a===e)return k(t,{type:"ENDPOINT"}).then(_);if("bind"===a)return p(t,n.slice(0,-1));const[c,l]=v(o);return k(t,{type:"APPLY",path:n.map((t=>t.toString())),argumentList:c},l).then(_)},construct(e,i){f(s);const[r,o]=v(i);return k(t,{type:"CONSTRUCT",path:n.map((t=>t.toString())),argumentList:r},o).then(_)}});return o}function m(t){return Array.prototype.concat.apply([],t)}function v(t){const e=t.map(y);return[e.map((t=>t[0])),m(e.map((t=>t[1])))]}const b=new WeakMap;function w(t,e){return b.set(t,e),t}function g(e){return Object.assign(e,{[t]:!0})}function y(t){for(const[e,n]of c)if(n.canHandle(t)){const[i,r]=n.serialize(t);return[{type:"HANDLER",name:e,value:i},r]}return[{type:"RAW",value:t},b.get(t)||[]]}function _(t){switch(t.type){case"HANDLER":return c.get(t.name).deserialize(t.value);case"RAW":return t.value}}function k(t,e,n){return new Promise((i=>{const r=E();t.addEventListener("message",(function e(n){n.data&&n.data.id&&n.data.id===r&&(t.removeEventListener("message",e),i(n.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:r},e),n)}))}function E(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class S{millis(){return Date.now()}}function j(t,e){for(const n of t)if(!1===e(n))return!1;return!0}function O(t,e){for(const n of t)if(!0===e(n))return!0;return!1}function T(t,e){let n=0;for(const i of t)!0===e(i)&&n++;return n}function R(t,e,n){let i=t.get(e);return void 0===i&&(i=n(e),t.set(e,i)),i}class M{constructor(t){x(this,"base",void 0),x(this,"map",new Map),this.base=t}getDebit(t,e=!1){const n=this.ensure(t).debit;return e?n:n+(this.base?.getDebit(t)??0)}getCredit(t,e=!1){const n=this.ensure(t).credit;return e?n:n+(this.base?.getCredit(t)??0)}addDebit(t,e){this.ensure(t).addDebit(e)}addCredit(t,e){this.ensure(t).addCredit(e)}*deltas(){for(const t of this.map.keys()){const e=this.getDebit(t,!0),n=this.getCredit(t,!0);yield[t,{debit:e,credit:n}]}}addDelta(t,e){const n=this.ensure(t);n.addDebit(e.debit),n.addCredit(e.credit)}merge(t=!0){if(!this.base)throw new Error("cannot merge delta set with no base set");for(const[e,n]of this.map.entries())this.base.addDelta(e,n),n.reset();t&&this.clear()}clear(){this.map.clear()}ensure(t){return R(this.map,t,(()=>new P))}}class P{constructor(t){x(this,"_credit",0),x(this,"_debit",0),t&&(this._credit=t._credit,this._debit=t._debit)}get debit(){return this._debit}get credit(){return this._credit}addDebit(t){if(t<0)throw new Error("the specified value must be non-negative");this._debit+=t}addCredit(t){if(t<0)throw new Error("the specified value must be non-negative");this._credit+=t}addDelta(t){this._debit+=t.debit,this._credit+=t.credit}reset(){this._debit=0,this._credit=0}}function C(t,e){const n=Object.create(null),i=t.split(",");for(let r=0;r<i.length;r++)n[i[r]]=!0;return e?t=>!!n[t.toLowerCase()]:t=>!!n[t]}function D(t){if(V(t)){const e={};for(let n=0;n<t.length;n++){const i=t[n],r=J(i)?N(i):D(i);if(r)for(const t in r)e[t]=r[t]}return e}return J(t)||Z(t)?t:void 0}const I=/;(?![^(]*\))/g,A=/:(.+)/;function N(t){const e={};return t.split(I).forEach((t=>{if(t){const n=t.split(A);n.length>1&&(e[n[0].trim()]=n[1].trim())}})),e}function L(t){let e="";if(J(t))t;else if(V(t))for(let n=0;n<t.length;n++){const e=L(t[n]);e&&e+" "}else if(Z(t))for(const n in t)t[n]&&n+" ";return e.trim()}const F={},z=()=>{},U=()=>!1,B=/^on[^a-z]/,$=t=>B.test(t),q=Object.assign,W=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},Y=Object.prototype.hasOwnProperty,H=(t,e)=>Y.call(t,e),V=Array.isArray,G=t=>"[object Map]"===nt(t),K=t=>"[object Set]"===nt(t),Q=t=>"function"===typeof t,J=t=>"string"===typeof t,X=t=>"symbol"===typeof t,Z=t=>null!==t&&"object"===typeof t,tt=t=>Z(t)&&Q(t.then)&&Q(t.catch),et=Object.prototype.toString,nt=t=>et.call(t),it=t=>nt(t).slice(8,-1),rt=t=>"[object Object]"===nt(t),st=t=>J(t)&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,ot=t=>{const e=Object.create(null);return n=>{const i=e[n];return i||(e[n]=t(n))}},at=/-(\w)/g,ct=(ot((t=>t.replace(at,((t,e)=>e?e.toUpperCase():"")))),/\B([A-Z])/g),lt=(ot((t=>t.replace(ct,"-$1").toLowerCase())),ot((t=>t.charAt(0).toUpperCase()+t.slice(1)))),ut=(ot((t=>t?`on${lt(t)}`:"")),(t,e)=>!Object.is(t,e)),dt=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},ht=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})};let ft;function pt(t,e=ft){e&&e.active&&e.effects.push(t)}const mt=t=>{const e=new Set(t);return e.w=0,e.n=0,e},vt=t=>(t.w&kt)>0,bt=t=>(t.n&kt)>0,wt=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=kt},gt=t=>{const{deps:e}=t;if(e.length){let n=0;for(let i=0;i<e.length;i++){const r=e[i];vt(r)&&!bt(r)?r.delete(t):e[n++]=r,r.w&=~kt,r.n&=~kt}e.length=n}},yt=new WeakMap;let _t=0,kt=1;const Et=30;let xt;const St=Symbol(""),jt=Symbol("");class Ot{constructor(t,e=null,n){this.fn=t,this.scheduler=e,this.active=!0,this.deps=[],this.parent=void 0,pt(this,n)}run(){if(!this.active)return this.fn();let t=xt,e=Rt;while(t){if(t===this)return;t=t.parent}try{return this.parent=xt,xt=this,Rt=!0,kt=1<<++_t,_t<=Et?wt(this):Tt(this),this.fn()}finally{_t<=Et&&gt(this),kt=1<<--_t,xt=this.parent,Rt=e,this.parent=void 0,this.deferStop&&this.stop()}}stop(){xt===this?this.deferStop=!0:this.active&&(Tt(this),this.onStop&&this.onStop(),this.active=!1)}}function Tt(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let Rt=!0;const Mt=[];function Pt(){Mt.push(Rt),Rt=!1}function Ct(){const t=Mt.pop();Rt=void 0===t||t}function Dt(t,e,n){if(Rt&&xt){let e=yt.get(t);e||yt.set(t,e=new Map);let i=e.get(n);i||e.set(n,i=mt());const r=void 0;It(i,r)}}function It(t,e){let n=!1;_t<=Et?bt(t)||(t.n|=kt,n=!vt(t)):n=!t.has(xt),n&&(t.add(xt),xt.deps.push(t))}function At(t,e,n,i,r,s){const o=yt.get(t);if(!o)return;let a=[];if("clear"===e)a=[...o.values()];else if("length"===n&&V(t))o.forEach(((t,e)=>{("length"===e||e>=i)&&a.push(t)}));else switch(void 0!==n&&a.push(o.get(n)),e){case"add":V(t)?st(n)&&a.push(o.get("length")):(a.push(o.get(St)),G(t)&&a.push(o.get(jt)));break;case"delete":V(t)||(a.push(o.get(St)),G(t)&&a.push(o.get(jt)));break;case"set":G(t)&&a.push(o.get(St));break}if(1===a.length)a[0]&&Nt(a[0]);else{const t=[];for(const e of a)e&&t.push(...e);Nt(mt(t))}}function Nt(t,e){for(const n of V(t)?t:[...t])(n!==xt||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}const Lt=C("__proto__,__v_isRef,__isVue"),Ft=new Set(Object.getOwnPropertyNames(Symbol).map((t=>Symbol[t])).filter(X)),zt=qt(),Ut=qt(!0),Bt=$t();function $t(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const n=Re(this);for(let e=0,r=this.length;e<r;e++)Dt(n,"get",e+"");const i=n[e](...t);return-1===i||!1===i?n[e](...t.map(Re)):i}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){Pt();const n=Re(this)[e].apply(this,t);return Ct(),n}})),t}function qt(t=!1,e=!1){return function(n,i,r){if("__v_isReactive"===i)return!t;if("__v_isReadonly"===i)return t;if("__v_isShallow"===i)return e;if("__v_raw"===i&&r===(t?e?ye:ge:e?we:be).get(n))return n;const s=V(n);if(!t&&s&&H(Bt,i))return Reflect.get(Bt,i,r);const o=Reflect.get(n,i,r);if(X(i)?Ft.has(i):Lt(i))return o;if(t||Dt(n,"get",i),e)return o;if(Ae(o)){const t=!s||!st(i);return t?o.value:o}return Z(o)?t?xe(o):Ee(o):o}}const Wt=Yt();function Yt(t=!1){return function(e,n,i,r){let s=e[n];if(Oe(s)&&Ae(s)&&!Ae(i))return!1;if(!t&&!Oe(i)&&(Te(i)||(i=Re(i),s=Re(s)),!V(e)&&Ae(s)&&!Ae(i)))return s.value=i,!0;const o=V(e)&&st(n)?Number(n)<e.length:H(e,n),a=Reflect.set(e,n,i,r);return e===Re(r)&&(o?ut(i,s)&&At(e,"set",n,i,s):At(e,"add",n,i)),a}}function Ht(t,e){const n=H(t,e),i=t[e],r=Reflect.deleteProperty(t,e);return r&&n&&At(t,"delete",e,void 0,i),r}function Vt(t,e){const n=Reflect.has(t,e);return X(e)&&Ft.has(e)||Dt(t,"has",e),n}function Gt(t){return Dt(t,"iterate",V(t)?"length":St),Reflect.ownKeys(t)}const Kt={get:zt,set:Wt,deleteProperty:Ht,has:Vt,ownKeys:Gt},Qt={get:Ut,set(t,e){return!0},deleteProperty(t,e){return!0}},Jt=t=>t,Xt=t=>Reflect.getPrototypeOf(t);function Zt(t,e,n=!1,i=!1){t=t["__v_raw"];const r=Re(t),s=Re(e);e!==s&&!n&&Dt(r,"get",e),!n&&Dt(r,"get",s);const{has:o}=Xt(r),a=i?Jt:n?Ce:Pe;return o.call(r,e)?a(t.get(e)):o.call(r,s)?a(t.get(s)):void(t!==r&&t.get(e))}function te(t,e=!1){const n=this["__v_raw"],i=Re(n),r=Re(t);return t!==r&&!e&&Dt(i,"has",t),!e&&Dt(i,"has",r),t===r?n.has(t):n.has(t)||n.has(r)}function ee(t,e=!1){return t=t["__v_raw"],!e&&Dt(Re(t),"iterate",St),Reflect.get(t,"size",t)}function ne(t){t=Re(t);const e=Re(this),n=Xt(e),i=n.has.call(e,t);return i||(e.add(t),At(e,"add",t,t)),this}function ie(t,e){e=Re(e);const n=Re(this),{has:i,get:r}=Xt(n);let s=i.call(n,t);s||(t=Re(t),s=i.call(n,t));const o=r.call(n,t);return n.set(t,e),s?ut(e,o)&&At(n,"set",t,e,o):At(n,"add",t,e),this}function re(t){const e=Re(this),{has:n,get:i}=Xt(e);let r=n.call(e,t);r||(t=Re(t),r=n.call(e,t));const s=i?i.call(e,t):void 0,o=e.delete(t);return r&&At(e,"delete",t,void 0,s),o}function se(){const t=Re(this),e=0!==t.size,n=void 0,i=t.clear();return e&&At(t,"clear",void 0,void 0,n),i}function oe(t,e){return function(n,i){const r=this,s=r["__v_raw"],o=Re(s),a=e?Jt:t?Ce:Pe;return!t&&Dt(o,"iterate",St),s.forEach(((t,e)=>n.call(i,a(t),a(e),r)))}}function ae(t,e,n){return function(...i){const r=this["__v_raw"],s=Re(r),o=G(s),a="entries"===t||t===Symbol.iterator&&o,c="keys"===t&&o,l=r[t](...i),u=n?Jt:e?Ce:Pe;return!e&&Dt(s,"iterate",c?jt:St),{next(){const{value:t,done:e}=l.next();return e?{value:t,done:e}:{value:a?[u(t[0]),u(t[1])]:u(t),done:e}},[Symbol.iterator](){return this}}}}function ce(t){return function(...e){return"delete"!==t&&this}}function le(){const t={get(t){return Zt(this,t)},get size(){return ee(this)},has:te,add:ne,set:ie,delete:re,clear:se,forEach:oe(!1,!1)},e={get(t){return Zt(this,t,!1,!0)},get size(){return ee(this)},has:te,add:ne,set:ie,delete:re,clear:se,forEach:oe(!1,!0)},n={get(t){return Zt(this,t,!0)},get size(){return ee(this,!0)},has(t){return te.call(this,t,!0)},add:ce("add"),set:ce("set"),delete:ce("delete"),clear:ce("clear"),forEach:oe(!0,!1)},i={get(t){return Zt(this,t,!0,!0)},get size(){return ee(this,!0)},has(t){return te.call(this,t,!0)},add:ce("add"),set:ce("set"),delete:ce("delete"),clear:ce("clear"),forEach:oe(!0,!0)},r=["keys","values","entries",Symbol.iterator];return r.forEach((r=>{t[r]=ae(r,!1,!1),n[r]=ae(r,!0,!1),e[r]=ae(r,!1,!0),i[r]=ae(r,!0,!0)})),[t,n,e,i]}const[ue,de,he,fe]=le();function pe(t,e){const n=e?t?fe:he:t?de:ue;return(e,i,r)=>"__v_isReactive"===i?!t:"__v_isReadonly"===i?t:"__v_raw"===i?e:Reflect.get(H(n,i)&&i in e?n:e,i,r)}const me={get:pe(!1,!1)},ve={get:pe(!0,!1)};const be=new WeakMap,we=new WeakMap,ge=new WeakMap,ye=new WeakMap;function _e(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ke(t){return t["__v_skip"]||!Object.isExtensible(t)?0:_e(it(t))}function Ee(t){return Oe(t)?t:Se(t,!1,Kt,me,be)}function xe(t){return Se(t,!0,Qt,ve,ge)}function Se(t,e,n,i,r){if(!Z(t))return t;if(t["__v_raw"]&&(!e||!t["__v_isReactive"]))return t;const s=r.get(t);if(s)return s;const o=ke(t);if(0===o)return t;const a=new Proxy(t,2===o?i:n);return r.set(t,a),a}function je(t){return Oe(t)?je(t["__v_raw"]):!(!t||!t["__v_isReactive"])}function Oe(t){return!(!t||!t["__v_isReadonly"])}function Te(t){return!(!t||!t["__v_isShallow"])}function Re(t){const e=t&&t["__v_raw"];return e?Re(e):t}function Me(t){return ht(t,"__v_skip",!0),t}const Pe=t=>Z(t)?Ee(t):t,Ce=t=>Z(t)?xe(t):t;function De(t){Rt&&xt&&(t=Re(t),It(t.dep||(t.dep=mt())))}function Ie(t,e){t=Re(t),t.dep&&Nt(t.dep)}function Ae(t){return!(!t||!0!==t.__v_isRef)}function Ne(t){return Le(t,!1)}function Le(t,e){return Ae(t)?t:new Fe(t,e)}class Fe{constructor(t,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?t:Re(t),this._value=e?t:Pe(t)}get value(){return De(this),this._value}set value(t){t=this.__v_isShallow?t:Re(t),ut(t,this._rawValue)&&(this._rawValue=t,this._value=this.__v_isShallow?t:Pe(t),Ie(this,t))}}function ze(t){return Ae(t)?t.value:t}const Ue={get:(t,e,n)=>ze(Reflect.get(t,e,n)),set:(t,e,n,i)=>{const r=t[e];return Ae(r)&&!Ae(n)?(r.value=n,!0):Reflect.set(t,e,n,i)}};function Be(t){return je(t)?t:new Proxy(t,Ue)}let $e;const qe=t=>!0;$e=Symbol.iterator;class We{constructor(t){x(this,"iterator",void 0),this.iterator=t}[$e](){return this.iterator}toArray(){return Array.from(this)}toMap(t,e){return new Map(this.map((n=>[t(n),e(n)])))}map(t){const e=this;return new We(function*(){for(const n of e)yield t(n)}())}flatMap(t){const e=this;return new We(function*(){for(const n of e)for(const e of t(n))yield e}())}all(t){return j(this,t??qe)}any(t){return O(this,t??qe)}count(t){return T(this,t??qe)}first(){for(const t of this.take(1))return t;throw new Error("Expected at least one item but iterable was empty.")}take(t){const e=this;return new We(function*(){let n=0;for(const i of e){if(n++>=t)break;yield i}}())}filter(t){const e=this;return new We(function*(){for(const n of e)t(n)&&(yield n)}())}defined(){const t=this;return new We(function*(){for(const e of t)void 0!==e&&(yield e)}())}reduce(t,e){let n=t;for(const i of this)n=e(n,i);return n}}function Ye(t){function*e(){for(const e of t)yield e}return new We(e())}class He{constructor(t){x(this,"id",void 0),this.id=t}}class Ve extends He{constructor(t){super(t),x(this,"id",void 0),x(this,"state",void 0),this.id=t,this.state=Ee({value:void 0})}watch(t){t.watch(this.id,this.state)}get(){return this.state.value}getOr(t){return this.state.value??t}set(t){this.state.value=t}}class Ge{constructor(t,e){x(this,"id",void 0),x(this,"watcher",void 0),x(this,"pool",void 0),this.id=t,this.watcher=e,this.pool=Ee(new Map)}add(t){this.pool.set(t.id,t),t.watch?.(this.watcher)}remove(t){this.pool.delete(t),this.watcher.unwatch(t)}get(t){const e=this.pool.get(t);if(void 0===e)throw new Error(`There is no registered entity with the ID '${t}'.`);return e}enumerate(){return Ye(this.pool.values())}get size(){return this.pool.size}}var Ke;function Qe(t){return e=>e.val(t)}function Je(t,e){return t instanceof Function?t(e):t}(function(t){t[t["EMPTY"]=0]="EMPTY",t[t["ORDERED"]=1]="ORDERED",t[t["READY"]=2]="READY"})(Ke||(Ke={}));const Xe={"unlock.section.society":({admin:t})=>t.resource("kittens").state.unlocked,"unlock.section.management":Qe("unlock.section.happiness"),"unlock.section.happiness":({admin:t})=>t.pops().size>=5,"unlock.section.science":({admin:t})=>t.building("library").state.level>0,"unlock.job.scholar":({admin:t})=>t.building("library").state.level>0,"unlock.job.farmer":({admin:t})=>t.tech("agriculture").state.researched,"unlock.job.hunter":({admin:t})=>t.tech("archery").state.researched,"unlock.job.miner":({admin:t})=>t.building("mine").state.level>0,"unlock.building.barn":({admin:t})=>t.tech("agriculture").state.researched,"unlock.building.mine":({admin:t})=>t.tech("mining").state.researched},Ze=t=>e=>{const n=e.admin.building(t).state;return n.unlocked?n.level:void 0},tn=t=>e=>{const n=e.admin.resource(t).state;return n.unlocked?n.amount:void 0},en=t=>e=>e.admin.pops().withJob(t).count(),nn=t=>cn(t,(t=>t.val("population.happiness.total"))),rn=(...t)=>e=>{for(const n of t){const t=Je(n,e);if(void 0!==t)return t}},sn=(t,e)=>n=>n.admin.tech(t).state.researched?Je(e,n):void 0,on=(...t)=>e=>{let n;for(const i of t){const t=Je(i,e);void 0!==t&&(void 0===n?n=t:n+=t)}return n},an=(...t)=>e=>{let n=0;for(const i of t){const t=Je(i,e);if(void 0===t)return;n+=t}return n},cn=(...t)=>e=>{let n;for(const i of t){const t=Je(i,e);void 0!==t&&(void 0===n?n=t:n*=t)}return n},ln=(...t)=>e=>{let n=1;for(const i of t){const t=Je(i,e);if(void 0===t)return;n*=t}return n},un=(t,e)=>n=>{const i=Je(t,n),r=Je(e,n);return void 0===i||void 0===r?void 0:i-r},dn=(t,e)=>n=>{const i=Je(t,n),r=Je(e,n);return void 0===i||void 0===r?void 0:i*(1+r)},hn=t=>e=>t,fn={"catnip.limit.base":hn(5e3),"catnip.limit":on(Qe("catnip.limit.base"),Qe("barn.catnip-limit")),"wood.limit.base":hn(200),"wood.limit":on(Qe("wood.limit.base"),Qe("barn.wood-limit")),"minerals.limit.base":hn(250),"minerals.limit":on(Qe("minerals.limit.base"),Qe("barn.minerals-limit")),"science.limit":Qe("library.science-limit"),"catpower.limit.base":hn(0),"catpower.limit":on(Qe("catpower.limit.base"),Qe("hut.catpower-limit")),"kittens.limit":Qe("hut.kittens-limit"),"catnip.delta":un(Qe("catnip.production"),Qe("population.catnip-demand")),"catnip.production":on(dn(Qe("catnip-field.catnip"),Qe("weather.ratio")),Qe("jobs.farmer.catnip")),"wood.delta":Qe("wood.production"),"wood.production":on(Qe("jobs.woodcutter.wood")),"minerals.delta":Qe("minerals.production"),"minerals.production":dn(Qe("jobs.miner.minerals"),rn(Qe("minerals.ratio"),hn(0))),"minerals.ratio":Qe("mine.minerals-ratio"),"science.delta":Qe("science.production"),"science.production":dn(Qe("jobs.scholar.science"),rn(Qe("science.ratio"),hn(0))),"astronomy.rare-event.reward.base":hn(25),"astronomy.rare-event.reward":dn(Qe("astronomy.rare-event.reward.base"),rn(Qe("science.ratio"),hn(0))),"science.ratio":Qe("library.science-ratio"),"catpower.delta":Qe("catpower.production"),"catpower.production":Qe("jobs.hunter.catpower"),"catnip-field.catnip.base":hn(.125),"catnip-field.catnip":ln(Qe("catnip-field.catnip.base"),rn(Ze("catnip-field"),hn(0))),"hut.kittens-limit.base":hn(2),"hut.kittens-limit":ln(Qe("hut.kittens-limit.base"),rn(Ze("hut"),hn(0))),"hut.catpower-limit.base":sn("archery",hn(75)),"hut.catpower-limit":ln(Qe("hut.catpower-limit.base"),rn(Ze("hut"),hn(0))),"library.science-limit.base":hn(250),"library.science-limit":ln(Qe("library.science-limit.base"),rn(Ze("library"),hn(0))),"library.science-ratio.base":hn(.1),"library.science-ratio":ln(Qe("library.science-ratio.base"),rn(Ze("library"),hn(0))),"barn.catnip-limit.base":hn(5e3),"barn.catnip-limit":ln(Qe("barn.catnip-limit.base"),Ze("barn")),"barn.wood-limit.base":hn(200),"barn.wood-limit":ln(Qe("barn.wood-limit.base"),Ze("barn")),"barn.minerals-limit.base":sn("mining",hn(250)),"barn.minerals-limit":ln(Qe("barn.minerals-limit.base"),Ze("barn")),"mine.minerals-ratio.base":hn(.2),"mine.minerals-ratio":ln(Qe("mine.minerals-ratio.base"),Ze("mine")),"population.happiness.base":hn(1),"population.overpopulation.base":hn(-.02),"population.overpopulation.severity":({admin:t})=>{const e=t.pops().size;if(!(e<5))return e-5},"population.overpopulation":ln(Qe("population.overpopulation.base"),Qe("population.overpopulation.severity")),"population.happiness.total":an(Qe("population.happiness.base"),Qe("population.overpopulation")),"population.catnip-demand.base":hn(.85),"population.catnip-demand":ln(Qe("population.catnip-demand.base"),rn(tn("kittens"),hn(0))),"weather.season-ratio":({admin:t})=>{switch(t.environment().state.season){case"spring":return.5;case"winter":return-.75;case"autumn":case"summer":return 0}},"weather.severity-ratio":({admin:t})=>{switch(t.environment().state.weather){case"warm":return.15;case"cold":return-.15;case"neutral":return 0}},"weather.ratio":an(Qe("weather.season-ratio"),Qe("weather.severity-ratio")),"jobs.woodcutter.wood.base":nn(hn(.018)),"jobs.woodcutter.wood":ln(Qe("jobs.woodcutter.wood.base"),en("woodcutter")),"jobs.scholar.science.base":nn(hn(.035)),"jobs.scholar.science":ln(Qe("jobs.scholar.science.base"),en("scholar")),"jobs.farmer.catnip.base":nn(hn(1)),"jobs.farmer.catnip":ln(Qe("jobs.farmer.catnip.base"),en("farmer")),"jobs.hunter.catpower.base":nn(hn(.06)),"jobs.hunter.catpower":ln(Qe("jobs.hunter.catpower.base"),en("hunter")),"jobs.miner.minerals.base":nn(hn(.05)),"jobs.miner.minerals":ln(Qe("jobs.miner.minerals.base"),en("miner"))};class pn{constructor(t){x(this,"watcher",void 0),x(this,"_booleans",void 0),x(this,"_buildings",void 0),x(this,"_fulfillments",void 0),x(this,"_jobs",void 0),x(this,"_numbers",void 0),x(this,"_pops",void 0),x(this,"_recipes",void 0),x(this,"_resources",void 0),x(this,"_sections",void 0),x(this,"_stockpiles",void 0),x(this,"_techs",void 0),x(this,"_effectTree",void 0),x(this,"_environment",void 0),x(this,"_player",void 0),x(this,"_time",void 0),x(this,"_prng",void 0),x(this,"_history",void 0),x(this,"_transactions",void 0),this.watcher=t,this._booleans=new Qi(this.watcher.pooled("booleans")),this._buildings=new _r(this.watcher.pooled("buildings")),this._fulfillments=new Sr(this.watcher.pooled("fulfillments")),this._jobs=new Or(this.watcher.pooled("jobs")),this._numbers=new Pr(this.watcher.pooled("numbers")),this._pops=new Ir(this.watcher.pooled("pops")),this._recipes=new Br(this.watcher.pooled("recipes")),this._resources=new qr(this.watcher.pooled("resources")),this._sections=new Yr(this.watcher.pooled("sections")),this._stockpiles=new Vr(this.watcher.pooled("stockpiles")),this._techs=new Kr(this.watcher.pooled("techs")),this._effectTree=new kr,this._effectTree.watch(this.watcher.pooled()),this._environment=new Er,this._environment.watch(this.watcher.pooled()),this._player=new Cr,this._player.watch(this.watcher.pooled()),this._time=new Qr,this._time.watch(this.watcher.pooled()),this._history=new Rr(this.watcher.buffered("history")),this._prng=new zr,this._transactions=new Zr}loadState(t){for(const e in this)if(Object.prototype.hasOwnProperty.call(this,e)){const n=this[e];n.loadState&&n.loadState(t)}}saveState(t){for(const e in this)if(Object.prototype.hasOwnProperty.call(this,e)){const n=this[e];n.saveState&&n.saveState(t)}}booleans(){return this._booleans.enumerate()}boolean(t){return this._booleans.get(t)}building(t){return this._buildings.get(t)}buildings(){return this._buildings.enumerate()}fulfillments(){return this._fulfillments.enumerate()}fulfillment(t){return this._fulfillments.get(t)}job(t){return this._jobs.get(t)}jobs(){return this._jobs.enumerate()}number(t){return this._numbers.get(t)}numbers(){return this._numbers.enumerate()}pops(){return this._pops}recipe(t){return this._recipes.get(t)}recipes(){return this._recipes.enumerate()}resource(t){return this._resources.get(t)}resources(){return this._resources.enumerate()}section(t){return this._sections.get(t)}sections(){return this._sections.enumerate()}stockpile(t){return this._stockpiles.get(t)}tech(t){return this._techs.get(t)}techs(){return this._techs.enumerate()}environment(){return this._environment}player(){return this._player}prng(){return this._prng}effectTree(){return this._effectTree}time(){return this._time}transactions(){return this._transactions}history(){return this._history}}function mn(t,e,n,i){let r;try{r=i?t(...i):t()}catch(s){bn(s,e,n)}return r}function vn(t,e,n,i){if(Q(t)){const r=mn(t,e,n,i);return r&&tt(r)&&r.catch((t=>{bn(t,e,n)})),r}const r=[];for(let s=0;s<t.length;s++)r.push(vn(t[s],e,n,i));return r}function bn(t,e,n,i=!0){const r=e?e.vnode:null;if(e){let i=e.parent;const r=e.proxy,s=n;while(i){const e=i.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,r,s))return;i=i.parent}const o=e.appContext.config.errorHandler;if(o)return void mn(o,null,10,[t,r,s])}wn(t,n,r,i)}function wn(t,e,n,i=!0){console.error(t)}let gn=!1,yn=!1;const _n=[];let kn=0;const En=[];let xn=null,Sn=0;const jn=[];let On=null,Tn=0;const Rn=Promise.resolve();let Mn=null,Pn=null;function Cn(t){const e=Mn||Rn;return t?e.then(this?t.bind(this):t):e}function Dn(t){let e=kn+1,n=_n.length;while(e<n){const i=e+n>>>1,r=Bn(_n[i]);r<t?e=i+1:n=i}return e}function In(t){_n.length&&_n.includes(t,gn&&t.allowRecurse?kn+1:kn)||t===Pn||(null==t.id?_n.push(t):_n.splice(Dn(t.id),0,t),An())}function An(){gn||yn||(yn=!0,Mn=Rn.then($n))}function Nn(t,e,n,i){V(t)?n.push(...t):e&&e.includes(t,t.allowRecurse?i+1:i)||n.push(t),An()}function Ln(t){Nn(t,xn,En,Sn)}function Fn(t){Nn(t,On,jn,Tn)}function zn(t,e=null){if(En.length){for(Pn=e,xn=[...new Set(En)],En.length=0,Sn=0;Sn<xn.length;Sn++)xn[Sn]();xn=null,Sn=0,Pn=null,zn(t,e)}}function Un(t){if(jn.length){const t=[...new Set(jn)];if(jn.length=0,On)return void On.push(...t);for(On=t,On.sort(((t,e)=>Bn(t)-Bn(e))),Tn=0;Tn<On.length;Tn++)On[Tn]();On=null,Tn=0}}const Bn=t=>null==t.id?1/0:t.id;function $n(t){yn=!1,gn=!0,zn(t),_n.sort(((t,e)=>Bn(t)-Bn(e)));try{for(kn=0;kn<_n.length;kn++){const t=_n[kn];t&&!1!==t.active&&mn(t,null,14)}}finally{kn=0,_n.length=0,Un(t),gn=!1,Mn=null,(_n.length||En.length||jn.length)&&$n(t)}}new Set;new Map;let qn=null;function Wn(t,e){e&&e.pendingBranch?V(t)?e.effects.push(...t):e.effects.push(t):Fn(t)}function Yn(t,e){return Gn(t,null,{flush:"sync"})}const Hn={};function Vn(t,e,n){return Gn(t,e,n)}function Gn(t,e,{immediate:n,deep:i,flush:r,onTrack:s,onTrigger:o}=F){const a=Fi;let c,l,u=!1,d=!1;if(Ae(t)?(c=()=>t.value,u=Te(t)):je(t)?(c=()=>t,i=!0):V(t)?(d=!0,u=t.some(je),c=()=>t.map((t=>Ae(t)?t.value:je(t)?Jn(t):Q(t)?mn(t,a,2):void 0))):c=Q(t)?e?()=>mn(t,a,2):()=>{if(!a||!a.isUnmounted)return l&&l(),vn(t,a,3,[h])}:z,e&&i){const t=c;c=()=>Jn(t())}let h=t=>{l=v.onStop=()=>{mn(t,a,4)}};if(qi)return h=z,e?n&&vn(e,a,3,[c(),d?[]:void 0,h]):c(),z;let f=d?[]:Hn;const p=()=>{if(v.active)if(e){const t=v.run();(i||u||(d?t.some(((t,e)=>ut(t,f[e]))):ut(t,f)))&&(l&&l(),vn(e,a,3,[t,f===Hn?void 0:f,h]),f=t)}else v.run()};let m;p.allowRecurse=!!e,m="sync"===r?p:"post"===r?()=>ji(p,a&&a.suspense):()=>{!a||a.isMounted?Ln(p):p()};const v=new Ot(c,m);return e?n?p():f=v.run():"post"===r?ji(v.run.bind(v),a&&a.suspense):v.run(),()=>{v.stop(),a&&a.scope&&W(a.scope.effects,v)}}function Kn(t,e,n){const i=this.proxy,r=J(t)?t.includes(".")?Qn(i,t):()=>i[t]:t.bind(i,i);let s;Q(e)?s=e:(s=e.handler,n=e);const o=Fi;Ui(this);const a=Gn(r,s.bind(i),n);return o?Ui(o):Bi(),a}function Qn(t,e){const n=e.split(".");return()=>{let e=t;for(let t=0;t<n.length&&e;t++)e=e[n[t]];return e}}function Jn(t,e){if(!Z(t)||t["__v_skip"])return t;if(e=e||new Set,e.has(t))return t;if(e.add(t),Ae(t))Jn(t.value,e);else if(V(t))for(let n=0;n<t.length;n++)Jn(t[n],e);else if(K(t)||G(t))t.forEach((t=>{Jn(t,e)}));else if(rt(t))for(const n in t)Jn(t[n],e);return t}function Xn(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return fi((()=>{t.isMounted=!0})),mi((()=>{t.isUnmounting=!0})),t}const Zn=[Function,Array];Boolean,Boolean;function ti(t,e){const{leavingVNodes:n}=t;let i=n.get(e.type);return i||(Object.create(null),n.set(e.type,i)),i}function ei(t,e,n,i){const{appear:r,mode:s,persisted:o=!1,onBeforeEnter:a,onEnter:c,onAfterEnter:l,onEnterCancelled:u,onBeforeLeave:d,onLeave:h,onAfterLeave:f,onLeaveCancelled:p,onBeforeAppear:m,onAppear:v,onAfterAppear:b,onAppearCancelled:w}=e,g=String(t.key),y=ti(n,t),_=(t,e)=>{t&&vn(t,i,9,e)},k={mode:s,persisted:o,beforeEnter(e){let i=a;if(!n.isMounted){if(!r)return;m||a}e._leaveCb&&e._leaveCb(!0);const s=y[g];s&&Mi(t,s)&&s.el._leaveCb&&s.el._leaveCb(),_(i,[e])},enter(t){let e=c,i=l,s=u;if(!n.isMounted){if(!r)return;v||c,b||l,w||u}let o=!1;const a=t._enterCb=e=>{o||(!0,_(e?s:i,[t]),k.delayedLeave&&k.delayedLeave(),t._enterCb=void 0)};e?(e(t,a),e.length<=1&&a()):a()},leave(e,i){const r=String(t.key);if(e._enterCb&&e._enterCb(!0),n.isUnmounting)return i();_(d,[e]);let s=!1;const o=e._leaveCb=n=>{s||(!0,i(),_(n?p:f,[e]),e._leaveCb=void 0,y[r]===t&&delete y[r])};y[r]=t,h?(h(e,o),h.length<=1&&o()):o()},clone(t){return ei(t,e,n,i)}};return k}function ni(t){if(ai(t))return Di(t),t.children=null,t}function ii(t){return ai(t)?t.children?t.children[0]:void 0:t}function ri(t,e){6&t.shapeFlag&&t.component?ri(t.component.subTree,e):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function si(t,e=!1,n){let i=[],r=0;for(let s=0;s<t.length;s++){let r=t[s];const o=null==n?r.key:String(n)+String(null!=r.key?r.key:s);r.type===Oi?(128&r.patchFlag&&0,i.concat(si(r.children,e,o))):(e||r.type!==Ti)&&i.push(null!=o?Di(r,{key:o}):r)}if(r>1)for(let s=0;s<i.length;s++)i[s].patchFlag=-2;return i}const oi=t=>!!t.type.__asyncLoader;const ai=t=>t.type.__isKeepAlive;RegExp,RegExp;function ci(t,e){return V(t)?t.some((t=>ci(t,e))):J(t)?t.split(",").includes(e):!!t.test&&t.test(e)}function li(t){let e=t.shapeFlag;256&e&&256,512&e&&512,t.shapeFlag=e}function ui(t){return 128&t.shapeFlag?t.ssContent:t}function di(t,e,n=Fi,i=!1){if(n){const r=n[t]||(n[t]=[]),s=e.__weh||(e.__weh=(...i)=>{if(n.isUnmounted)return;Pt(),Ui(n);const r=vn(e,n,t,i);return Bi(),Ct(),r});return i?r.unshift(s):r.push(s),s}}const hi=t=>(e,n=Fi)=>(!qi||"sp"===t)&&di(t,e,n),fi=(hi("bm"),hi("m")),pi=(hi("bu"),hi("u")),mi=hi("bum");hi("um"),hi("sp"),hi("rtg"),hi("rtc");function vi(t){const e=t.type,{mixins:n,extends:i}=e,{mixins:r,optionsCache:s,config:{optionMergeStrategies:o}}=t.appContext,a=s.get(e);let c;return a?c=a:r.length||n||i?(c={},r.length&&r.forEach((t=>bi(c,t,o,!0))),bi(c,e,o)):c=e,s.set(e,c),c}function bi(t,e,n,i=!1){const{mixins:r,extends:s}=e;s&&bi(t,s,n,!0),r&&r.forEach((e=>bi(t,e,n,!0)));for(const o in e)if(i&&"expose"===o);else{const i=wi[o]||n&&n[o];t[o]=i?i(t[o],e[o]):e[o]}return t}const wi={data:gi,props:Ei,emits:Ei,methods:Ei,computed:Ei,beforeCreate:ki,created:ki,beforeMount:ki,mounted:ki,beforeUpdate:ki,updated:ki,beforeDestroy:ki,beforeUnmount:ki,destroyed:ki,unmounted:ki,activated:ki,deactivated:ki,errorCaptured:ki,serverPrefetch:ki,components:Ei,directives:Ei,watch:xi,provide:gi,inject:yi};function gi(t,e){return e?t?function(){return q(Q(t)?t.call(this,this):t,Q(e)?e.call(this,this):e)}:e:t}function yi(t,e){return Ei(_i(t),_i(e))}function _i(t){if(V(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function ki(t,e){return t?[...new Set([].concat(t,e))]:e}function Ei(t,e){return t?q(q(Object.create(null),t),e):e}function xi(t,e){if(!t)return e;if(!e)return t;const n=q(Object.create(null),t);for(const i in e)n[i]=ki(t[i],e[i]);return n}function Si(){return{app:null,config:{isNativeTag:U,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}const ji=Wn;Symbol();const Oi=Symbol(void 0),Ti=(Symbol(void 0),Symbol(void 0));Symbol(void 0);function Ri(t){return!!t&&!0===t.__v_isVNode}function Mi(t,e){return t.type===e.type&&t.key===e.key}const Pi=({key:t})=>null!=t?t:null,Ci=({ref:t,ref_key:e,ref_for:n})=>null!=t?J(t)||Ae(t)||Q(t)?{i:qn,r:t,k:e,f:!!n}:t:null;function Di(t,e,n=!1){const{props:i,ref:r,patchFlag:s,children:o}=t,a=e?Ii(i||{},e):i,c={__v_isVNode:!0,__v_skip:!0,type:t.type,props:a,key:a&&Pi(a),ref:e&&e.ref?n&&r?V(r)?r.concat(Ci(e)):[r,Ci(e)]:Ci(e):r,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:o,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Oi?-1===s?16:16|s:s,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Di(t.ssContent),ssFallback:t.ssFallback&&Di(t.ssFallback),el:t.el,anchor:t.anchor};return c}function Ii(...t){const e={};for(let n=0;n<t.length;n++){const i=t[n];for(const t in i)if("class"===t)e.class!==i.class&&(e.class=L([e.class,i.class]));else if("style"===t)e.style=D([e.style,i.style]);else if($(t)){const n=e[t],r=i[t];!r||n===r||V(n)&&n.includes(r)||(e[t]=n?[].concat(n,r):r)}else""!==t&&(e[t]=i[t])}return e}function Ai(t,e,n,i=null){vn(t,e,7,[n,i])}const Ni=t=>t?$i(t)?Wi(t)||t.proxy:Ni(t.parent):null,Li=q(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Ni(t.parent),$root:t=>Ni(t.root),$emit:t=>t.emit,$options:t=>vi(t),$forceUpdate:t=>()=>In(t.update),$nextTick:t=>Cn.bind(t.proxy),$watch:t=>Kn.bind(t)});Si();let Fi=null;const zi=()=>Fi||qn,Ui=t=>{Fi=t,t.scope.on()},Bi=()=>{Fi&&Fi.scope.off(),Fi=null};function $i(t){return 4&t.vnode.shapeFlag}let qi=!1;function Wi(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(Be(Me(t.exposed)),{get(e,n){return n in e?e[n]:n in Li?Li[n](t):void 0}}))}function Yi(t){return Q(t)&&t.displayName||t.name}Symbol("");class Hi{constructor(){x(this,"handles",new Map),x(this,"singletons",new Vi("singletons")),x(this,"pools",new Map),x(this,"buffers",new Map)}pooled(t="singletons"){const e=R(this.pools,t,(t=>new Vi(t)));return this.watcher(e)}watcher(t){return{watch:(e,n)=>this.watchIn(t,e,n),unwatch:e=>this.unwatchIn(t,e)}}unwatchIn(t,e){const n=this.handles.get(e);n&&(n(),this.handles.delete(e)),t.remove(e)}watchIn(t,e,n){if(!je(n))throw new Error(`attempted to watch non-reactive state '${e}'`);t.add(e,Re(n));const i=Vn((()=>n),(n=>t.update(e,Re(n))),{deep:!0,flush:"sync"});this.handles.set(e,i)}buffered(t){const e=R(this.buffers,t,(t=>new Gi(t)));return this.wrapBuffer(e)}wrapBuffer(t){return{push:e=>t.items.push(e)}}flushMutations(t){const e=this.changedPools();t(e.map((t=>t.toMutationPool())));for(const n of e)n.clear()}flushEvents(t){const e=this.pendingBuffers();t(e.map((t=>t.toEventPool())));for(const n of e)n.clear()}changedPools(){const t=[];this.singletons.hasChanges()&&t.push(this.singletons);for(const e of this.pools.values())e.hasChanges()&&t.push(e);return t}pendingBuffers(){const t=[];for(const e of this.buffers.values())e.items.length>0&&t.push(e);return t}}class Vi{constructor(t){x(this,"poolId",void 0),x(this,"added",new Map),x(this,"updated",new Map),x(this,"removed",new Set),this.poolId=t}hasChanges(){return this.added.size>0||this.updated.size>0||this.removed.size>0}clear(){this.added.clear(),this.removed.clear(),this.updated.clear()}add(t,e){this.added.set(t,Re(e))}update(t,e){this.added.has(t)?this.added.set(t,Re(e)):this.updated.set(t,Re(e))}remove(t){this.added.has(t)?this.added.delete(t):(this.updated.delete(t),this.removed.add(t))}toMutationPool(){const t={poolId:this.poolId};return this.added.size>0&&(t.added=this.added),this.updated.size>0&&(t.updated=this.updated),this.removed.size>0&&(t.removed=this.removed),t}}class Gi{constructor(t){x(this,"id",void 0),x(this,"items",void 0),this.id=t,this.items=[]}toEventPool(){return{id:this.id,events:this.items}}clear(){this.items.length=0}}class Ki extends Ve{constructor(t){super(t),x(this,"id",void 0),this.id=t}}class Qi extends Ge{constructor(t){super("booleans",t);const e=Object.keys(Xe);for(const n of e)this.add(new Ki(n))}}function Ji(t){return Object.entries(t)}class Xi extends Map{static fromObject(t){return new Xi(Ji(t))}}function Zi(t){return Array.from(Ji(t),(([t,e])=>({resourceId:t,requirement:e,fulfillmentTime:void 0,fulfillment:0,capped:!1,fulfilled:!0})))}const tr={bonfireItems(){return Ye(er)},buildings(){return Ye(Object.values(nr))},building(t){return nr[t]},effectDisplay(t){return or[t]},jobs(){return Ye(Object.values(hr))},job(t){return hr[t]},recipes(){return Ye(Object.values(ir))},resources(){return Ye(Object.values(vr))},resource(t){return vr[t]},season(t){return ur[t]},sections(){return Ye(Object.values(br))},section(t){return br[t]},techs(){return Ye(Object.values(wr))},tech(t){return wr[t]},weather(t){return dr[t]}},er=["gather-catnip","refine-catnip","catnip-field","hut","library","barn","mine"],nr={"catnip-field":{id:"catnip-field",label:"buildings.catnip-field.label",description:"buildings.catnip-field.description",flavor:"buildings.catnip-field.flavor",prices:{ratio:1.12,base:{catnip:10}},unlock:{priceRatio:.3},effects:[{id:"catnip",per:"catnip-field.catnip.base",total:"catnip-field.catnip",label:"buildings.catnip-field.effects.catnip"}]},hut:{id:"hut",label:"buildings.hut.label",description:"buildings.hut.description",flavor:"buildings.hut.flavor",prices:{ratio:2.5,base:{wood:5}},unlock:{priceRatio:.3},effects:[{id:"kittens-limit",per:"hut.kittens-limit.base",total:"hut.kittens-limit",label:"buildings.hut.effects.kittens-limit"},{id:"catpower-limit",per:"hut.catpower-limit.base",total:"hut.catpower-limit",label:"buildings.hut.effects.catpower-limit"}]},library:{id:"library",label:"buildings.library.label",description:"buildings.library.description",flavor:"buildings.library.flavor",prices:{base:{wood:25},ratio:1.15},unlock:{priceRatio:.3},effects:[{id:"science-limit",per:"library.science-limit.base",total:"library.science-limit",label:"buildings.library.effects.science-limit"},{id:"science-ratio",per:"library.science-ratio.base",total:"library.science-ratio",label:"buildings.library.effects.science-ratio"}]},barn:{id:"barn",label:"buildings.barn.label",description:"buildings.barn.description",flavor:"buildings.barn.flavor",unlock:{priceRatio:.3,unlockEffect:"unlock.building.barn"},prices:{base:{wood:50},ratio:1.75},effects:[{id:"catnip-limit",per:"barn.catnip-limit.base",total:"barn.catnip-limit",label:"buildings.barn.effects.catnip-limit"},{id:"wood-limit",per:"barn.wood-limit.base",total:"barn.wood-limit",label:"buildings.barn.effects.wood-limit"},{id:"minerals-limit",per:"barn.minerals-limit.base",total:"barn.minerals-limit",label:"buildings.barn.effects.minerals-limit"}]},mine:{id:"mine",label:"buildings.mine.label",description:"buildings.mine.description",flavor:"buildings.mine.flavor",unlock:{priceRatio:.15,unlockEffect:"unlock.building.mine"},prices:{base:{wood:100},ratio:1.15},effects:[{id:"mineral-ratio",per:"mine.minerals-ratio.base",total:"mine.minerals-ratio",label:"buildings.mine.effects.minerals-ratio"}]}},ir={"refine-catnip":{id:"refine-catnip",ingredients:{catnip:100},products:{wood:1}}};class rr extends Map{}var sr;(function(t){t[t["None"]=0]="None",t[t["Tick"]=1]="Tick",t[t["PerTick"]=2]="PerTick",t[t["Percent"]=3]="Percent"})(sr||(sr={}));const or={"catnip.delta":cr("inline"),"catnip.production":cr("inline"),"catnip-field.catnip":{...cr("collapse"),label:"effect-tree.catnip-fields"},"catnip-field.catnip.base":cr(),"weather.ratio":{...lr("collapse"),label:"effect-tree.weather"},"weather.season-ratio":lr(),"weather.severity-ratio":lr(),"jobs.farmer.catnip":{...cr("collapse"),label:"effect-tree.farming"},"jobs.farmer.catnip.base":cr(),"population.catnip-demand":{...cr("collapse"),label:"effect-tree.village-demand",invert:!0},"population.catnip-demand.base":{...cr(),invert:!0},"wood.delta":cr("inline"),"wood.production":cr("inline"),"jobs.woodcutter.wood":{...cr("collapse"),label:"effect-tree.woodcutting"},"jobs.woodcutter.wood.base":cr(),"minerals.delta":cr("inline"),"minerals.production":cr("inline"),"jobs.miner.minerals":{...cr("collapse"),label:"effect-tree.mining"},"jobs.miner.minerals.base":cr(),"minerals.ratio":{...lr("collapse"),label:"effect-tree.bonus"},"mine.minerals-ratio":lr(),"mine.minerals-ratio.base":lr(),"science.delta":cr("inline"),"science.production":cr("inline"),"jobs.scholar.science":{...cr("collapse"),label:"effect-tree.researching"},"jobs.scholar.science.base":cr(),"science.ratio":{...lr("collapse"),label:"effect-tree.bonus"},"library.science-ratio":lr(),"library.science-ratio.base":lr(),"astronomy.rare-event.reward":ar(),"astronomy.rare-event.reward.base":ar(),"catpower.delta":cr("inline"),"catpower.production":cr("inline"),"jobs.hunter.catpower.base":cr(),"jobs.hunter.catpower":cr(),"population.happiness.total":lr("collapse"),"population.happiness.base":{...lr(),label:"effect-tree.base"},"population.overpopulation":{...lr("collapse"),label:"effect-tree.overpopulation"},"population.overpopulation.base":lr(),"population.overpopulation.severity":lr(),"catnip.limit":ar("inline"),"catnip.limit.base":ar(),"barn.catnip-limit":ar("inline"),"barn.catnip-limit.base":ar(),"wood.limit":ar("inline"),"wood.limit.base":ar(),"barn.wood-limit":ar("inline"),"barn.wood-limit.base":ar(),"minerals.limit":ar("inline"),"minerals.limit.base":ar(),"barn.minerals-limit":ar("inline"),"barn.minerals-limit.base":ar(),"science.limit":ar("inline"),"library.science-limit":ar("collapse"),"library.science-limit.base":ar(),"catpower.limit":ar("inline"),"catpower.limit.base":ar(),"hut.catpower-limit":ar("collapse"),"hut.catpower-limit.base":ar(),"kittens.limit":ar("inline"),"hut.kittens-limit":ar("collapse"),"hut.kittens-limit.base":ar()};function ar(t){return t?{unit:sr.None,disposition:t}:{unit:sr.None}}function cr(t){return t?{unit:sr.PerTick,disposition:t}:{unit:sr.PerTick}}function lr(t){return t?{unit:sr.Percent,disposition:t}:{unit:sr.Percent}}const ur={spring:{id:"spring",label:"environment.seasons.spring.label"},summer:{id:"summer",label:"environment.seasons.summer.label"},autumn:{id:"autumn",label:"environment.seasons.autumn.label"},winter:{id:"winter",label:"environment.seasons.winter.label"}},dr={neutral:{id:"neutral"},warm:{id:"warm",label:"environment.weather.warm"},cold:{id:"cold",label:"environment.weather.cold"}},hr={woodcutter:{id:"woodcutter",label:"jobs.woodcutter.label",description:"jobs.woodcutter.description",flavor:"jobs.woodcutter.flavor",effects:[{id:"wood",label:"jobs.woodcutter.effects.wood",base:"jobs.woodcutter.wood.base",total:"jobs.woodcutter.wood"}]},farmer:{id:"farmer",label:"jobs.farmer.label",description:"jobs.farmer.description",unlockEffect:"unlock.job.farmer",effects:[{id:"catnip",label:"jobs.farmer.effects.catnip",base:"jobs.farmer.catnip.base",total:"jobs.farmer.catnip"}]},scholar:{id:"scholar",label:"jobs.scholar.label",description:"jobs.scholar.description",unlockEffect:"unlock.job.scholar",effects:[{id:"science",label:"jobs.scholar.effects.science",base:"jobs.scholar.science.base",total:"jobs.scholar.science"}]},hunter:{id:"hunter",label:"jobs.hunter.label",description:"jobs.hunter.description",unlockEffect:"unlock.job.hunter",effects:[{id:"catpower",label:"jobs.hunter.effects.catpower",base:"jobs.hunter.catpower.base",total:"jobs.hunter.catpower"}]},miner:{id:"miner",label:"jobs.miner.label",description:"jobs.miner.description",flavor:"jobs.miner.flavor",unlockEffect:"unlock.job.miner",effects:[{id:"minerals",label:"jobs.miner.effects.minerals",base:"jobs.miner.minerals.base",total:"jobs.miner.minerals"}]}};function fr(t,e){return{kind:"label",label:t,named:e}}function pr(t,e,n){return{kind:"plural-label",label:t,plural:e,named:n}}var mr;(function(t){t[t["FirstQuantity"]=0]="FirstQuantity",t[t["FirstCapacity"]=1]="FirstCapacity"})(mr||(mr={}));const vr={catnip:{id:"catnip",label:"resources.catnip.label",effects:{delta:"catnip.delta",limit:"catnip.limit"}},wood:{id:"wood",label:"resources.wood.label",effects:{limit:"wood.limit",delta:"wood.delta"}},minerals:{id:"minerals",label:"resources.minerals.label",effects:{limit:"minerals.limit",delta:"minerals.delta"}},catpower:{id:"catpower",label:"resources.catpower.label",effects:{delta:"catpower.delta",limit:"catpower.limit"}},science:{id:"science",label:"resources.science.label",effects:{delta:"science.delta",limit:"science.limit"}},kittens:{id:"kittens",label:"resources.kittens.label",unlockMode:mr.FirstCapacity,effects:{limit:"kittens.limit"}}},br={bonfire:{id:"bonfire",label:"sections.bonfire.label"},society:{id:"society",label:"sections.society.label",unlockEffect:"unlock.section.society"},jobs:{id:"jobs",parent:"society",label:"sections.jobs.label"},management:{id:"management",parent:"society",label:"sections.management.label",unlockEffect:"unlock.section.management"},science:{id:"science",label:"sections.science.label",unlockEffect:"unlock.section.science"},technologies:{id:"technologies",parent:"science",label:"sections.technologies.label"}},wr={calendar:{id:"calendar",label:"tech.calendar.label",description:"tech.calendar.description",flavor:"tech.calendar.flavor",ingredients:{science:30},effects:[{id:"default",label:"tech.calendar.effect"}],dependsOn:[]},agriculture:{id:"agriculture",label:"tech.agriculture.label",description:"tech.agriculture.description",flavor:"tech.agriculture.flavor",ingredients:{science:100},effects:[{id:"default",label:"tech.agriculture.effect"}],dependsOn:["calendar"]},archery:{id:"archery",label:"tech.archery.label",description:"tech.archery.description",flavor:"tech.archery.flavor",ingredients:{science:300},effects:[{id:"default",label:"tech.archery.effect"}],dependsOn:["agriculture"]},mining:{id:"mining",label:"tech.mining.label",description:"tech.mining.description",flavor:"tech.mining.flavor",ingredients:{science:500},effects:[{id:"default",label:"tech.mining.effect"}],dependsOn:["agriculture"]}},gr={UpdatesPerTick:4,MillisPerTick:200,TicksPerDay:10,DaysPerSeason:100};class yr extends He{constructor(t){super(t.id),x(this,"meta",void 0),x(this,"state",void 0),x(this,"orderStatus",void 0),this.meta=t,this.state=Ee({unlocked:!1,level:0}),this.orderStatus=Ke.EMPTY}watch(t){t.watch(this.id,this.state)}save(){return{level:this.state.level,unlocked:this.state.unlocked}}load(t){void 0!==t&&(this.state.level=t.level,this.state.unlocked=t.unlocked)}}class _r extends Ge{constructor(t){super("buildings",t);for(const e of tr.buildings())this.add(new yr(e))}loadState(t){const e=t?.buildings;if(void 0!==e)for(const n of this.enumerate())n.load(e[n.id])}saveState(t){t.buildings={};for(const e of this.enumerate())t.buildings[e.id]=e.save()}}class kr extends He{constructor(){super("effect-tree"),x(this,"state",void 0),this.state=Ee(new rr)}watch(t){t.watch(this.id,this.state)}}class Er extends He{constructor(){super("environment"),x(this,"state",void 0),x(this,"observedSky",void 0),this.state=Ee({year:0,season:"spring",day:0,weather:"neutral",calendarLabel:"calendar.basic.no-weather",epochLabel:"calendar.epoch.basic"}),this.observedSky=!1}watch(t){t.watch(this.id,this.state)}loadState(t){t.environment&&Object.assign(this.state,t.environment)}saveState(t){t.environment={day:this.state.day,season:this.state.season,weather:this.state.weather,year:this.state.year}}}class xr extends He{constructor(t,e){super(t),x(this,"state",void 0),this.state=Ee({ingredients:Zi(e),capped:!1,fulfilled:!1})}watch(t){t.watch(this.id,this.state)}}class Sr extends Ge{constructor(t){super("fulfillments",t);for(const e of tr.buildings())this.add(new xr(e.id,e.prices.base));for(const e of tr.recipes())this.add(new xr(e.id,e.ingredients));for(const e of tr.techs())this.add(new xr(e.id,e.ingredients))}}class jr extends He{constructor(t){super(t.id),x(this,"meta",void 0),x(this,"state",void 0),this.meta=t,this.state=Ee({unlocked:void 0===t.unlockEffect})}watch(t){t.watch(this.id,this.state)}}class Or extends Ge{constructor(t){super("jobs",t);for(const e of tr.jobs())this.add(new jr(e))}}class Tr{constructor(t,e){x(this,"id",void 0),x(this,"buffer",void 0),this.id=t,this.buffer=e}push(t){this.buffer.push(t)}}class Rr extends Tr{constructor(t){super("history",t)}}class Mr extends Ve{constructor(t){super(t),x(this,"id",void 0),this.id=t}}class Pr extends Ge{constructor(t){super("numbers",t);const e=Object.keys(fn);for(const n of e)this.add(new Mr(n))}}class Cr extends He{constructor(){super("player"),x(this,"state",void 0),this.state=Ee({dev:!1,gatherCatnip:1,timeAcceleration:0,slowness:0})}watch(t){t.watch("player",this.state)}loadState(t){void 0!==t.player&&void 0!==t.player.dev&&(this.state.dev=!0,this.state.gatherCatnip=t.player.dev.gatherCatnip,this.state.timeAcceleration=t.player.dev.timeAcceleration)}saveState(t){t.player={dev:this.state.dev?{...this.state}:void 0}}}class Dr extends He{constructor(t){super(`pop-${t}`),x(this,"state",void 0),this.state=Ee({job:void 0,name:`Kitten #${t}`})}watch(t){t.watch(this.id,this.state)}}class Ir extends Ge{constructor(t){super("pops",t),x(this,"ids",void 0),x(this,"nextPopId",1),this.ids=[]}grow(t){return Array.from(this.growInternal(t))}*growInternal(t){let e=0;while(e++<t){const t=this.addNewPopEntity();yield t}}addNewPopEntity(){const t=new Dr(this.nextPopId++);return this.ids.push(t.id),super.add(t),t}loadState(t){if(this.ids.length=0,this.pool.clear(),this.nextPopId=1,void 0!==t.pops)for(const e of t.pops){const t=this.addNewPopEntity();t.state.job=e.job,t.state.name=e.name}}saveState(t){t.pops=[];for(const e of this.enumerate())t.pops.push({job:e.state.job,name:e.state.name})}kill(t){return Array.from(this.killInternal(t))}*killInternal(t){for(const e of this.ids.splice(this.ids.length-t))yield super.get(e),super.remove(e)}withJob(t){return this.enumerate().filter((e=>e.state.job===t))}}function Ar(t,e=0){return Lr(t,e,Math.round)}function Nr(t,e=0){return Lr(t,e,Math.trunc)}function Lr(t,e,n){const i=Math.pow(10,e),r=t*i,s=r*(1+Number.EPSILON);return n(s)/i}function Fr(t){let e=t;function n(){let t=e+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}return{state:()=>e,next:()=>n(),fork:()=>Fr(n())}}class zr extends He{constructor(){super("prng"),x(this,"_astronomy",void 0),x(this,"_environment",void 0);const t=Fr(Date.now());this._astronomy=t.fork(),this._environment=t.fork()}loadState(t){void 0!==t.seeds?.astronomy&&(this._astronomy=Fr(t.seeds.astronomy)),void 0!==t.seeds?.environment&&(this._environment=Fr(t.seeds.environment))}saveState(t){t.seeds={astronomy:this._astronomy.state(),environment:this._environment.state()}}environment(){return this._environment.next()}astronomy(){return this._astronomy.next()}}class Ur extends He{constructor(t){super(t.id),x(this,"meta",void 0),x(this,"state",void 0),x(this,"orderStatus",void 0),this.meta=t,this.state=Ee({products:Xi.fromObject(t.products)}),this.orderStatus=Ke.EMPTY}watch(t){t.watch(this.id,this.state)}}class Br extends Ge{constructor(t){super("recipes",t);for(const e of tr.recipes())this.add(new Ur(e))}}class $r extends He{constructor(t){super(t.id),x(this,"meta",void 0),x(this,"state",void 0),x(this,"delta",new P),this.meta=t,this.state=Ee({unlocked:!1,amount:0,change:0,capacity:void 0})}watch(t){t.watch(this.id,this.state)}load(t){t&&(this.state.amount=t.amount,this.state.unlocked=t.unlocked)}save(){return{amount:this.state.amount,unlocked:this.state.unlocked}}}class qr extends Ge{constructor(t){super("resources",t);for(const e of tr.resources())this.add(new $r(e))}loadState(t){const e=t.resources;if(void 0!==e)for(const n of this.enumerate())n.load(e[n.id])}saveState(t){t.resources={};for(const e of this.enumerate())t.resources[e.id]=e.save()}}class Wr extends He{constructor(t){super(t.id),x(this,"meta",void 0),x(this,"state",void 0),this.meta=t,this.state=Ee({unlocked:void 0===t.unlockEffect,label:t.label,alert:void 0})}watch(t){t.watch(this.id,this.state)}}class Yr extends Ge{constructor(t){super("sections",t);for(const e of tr.sections())this.add(new Wr(e))}}class Hr extends He{constructor(t){super(t),x(this,"state",void 0),this.state=Ee({amount:0})}watch(t){t.watch(this.id,this.state)}load(t){t&&(this.state.amount=t.amount)}save(){return{amount:this.state.amount}}}class Vr extends Ge{constructor(t){super("stockpiles",t),this.add(new Hr("kitten-growth")),this.add(new Hr("observe-sky"))}loadState(t){const e=t.stockpiles;if(void 0!==e)for(const n of this.enumerate())n.load(e[n.id])}saveState(t){t.stockpiles={};for(const e of this.enumerate())t.stockpiles[e.id]=e.save()}}class Gr extends He{constructor(t){super(t.id),x(this,"state",void 0),x(this,"orderStatus",void 0),this.state=Ee({unlocked:!1,researched:!1}),this.orderStatus=Ke.EMPTY}watch(t){t.watch(this.id,this.state)}}class Kr extends Ge{constructor(t){super("techs",t);for(const e of tr.techs())this.add(new Gr(e))}loadState(t){if(t.science)for(const e of this.enumerate()){const n=t.science[e.id];void 0!==n&&(e.state.researched=n.researched)}}saveState(t){t.science={};for(const e of this.enumerate())e.state.researched&&(t.science[e.id]={researched:!0})}}class Qr extends He{constructor(){super("time"),x(this,"state",void 0),x(this,"ticks",void 0),x(this,"days",void 0),this.state=Ee({millisPerTick:gr.MillisPerTick}),this.ticks=new Jr(1),this.days=new Jr(gr.TicksPerDay)}watch(t){t.watch(this.id,this.state)}loadState(t){t.time&&(this.ticks.absolute=t.time.ticks,this.days.absolute=t.time.days)}saveState(t){t.time={ticks:this.ticks.absolute,days:this.days.absolute}}*timers(){yield this.ticks,yield this.days}}class Jr{constructor(t=1){x(this,"absolute",0),x(this,"delta",0),x(this,"wholeTicks",0),x(this,"period",1),this.period=t}}var Xr=n(4609);class Zr extends He{constructor(){super("transactions"),x(this,"queue",new Xr.c)}enqueue(t){this.queue.enqueue(t)}*all(){let t;while(t=this.queue.dequeue())yield t}}class ts{constructor(t,e){x(this,"controller",void 0),x(this,"devTools",void 0),x(this,"dispatcher",void 0),x(this,"store",void 0),this.controller=t,this.dispatcher=new is(e),this.devTools=new ns(e),this.store=new Hs(e)}}class es{constructor(t,e,n,i){x(this,"admin",void 0),x(this,"update",void 0),x(this,"render",void 0),x(this,"timestamp",void 0),x(this,"lastTimestamp",0),x(this,"handle",void 0),x(this,"millisPerTick",gr.MillisPerTick),x(this,"slowness",Ne(1)),this.admin=t,this.update=e,this.render=n,this.timestamp=i,Yn((()=>{const t=Ar(this.admin.time().state.millisPerTick/this.slowness.value);this.millisPerTick=t}))}start(){this.lastTimestamp=this.timestamp.millis();const t=gr.MillisPerTick/gr.UpdatesPerTick;this.handle=setInterval((()=>this.doUpdate()),t)}stop(){clearInterval(this.handle)}doUpdate(){const t=this.timestamp.millis(),e=Math.round(t-this.lastTimestamp);this.lastTimestamp=t;const n=this.millisPerTick;let i=0;while(i<e){const t=Math.min(n,e-i);this.update(t),i+=t}this.render();const r=Date.now()-t,s=n*gr.UpdatesPerTick;this.slowness.value=r>s?s/r:1}}class ns{constructor(t){x(this,"admin",void 0),this.admin=t}get player(){return this.admin.player().state}turnDevToolsOn(){this.player.dev||(this.player.dev=!0)}turnDevToolsOff(){const t=this.player;t.dev&&(t.dev=!1,t.gatherCatnip=1,t.timeAcceleration=0)}setGatherCatnip(t){const e=this.player;if(!e.dev)throw new Error("devtools are off");e.gatherCatnip=t}setTimeAcceleration(t){const e=this.player;if(!e.dev)throw new Error("devtools are off");e.timeAcceleration=t}}class is{constructor(t){x(this,"admin",void 0),this.admin=t}async send(t){switch(t.kind){case"bonfire":return this.handleBonfire(t);case"construction":return this.handleConstruction(t);case"research":return this.handleResearch(t);case"workshop":return this.handleWorkshop(t);case"society":return this.handleSociety(t);default:throw new Error(`intent not supported: ${JSON.stringify(t)}`)}}handleBonfire(t){switch(t.id){case"gather-catnip":this.admin.resource("catnip").delta.addDebit(this.admin.player().state.gatherCatnip);break;case"observe-sky":this.admin.stockpile("observe-sky").state.amount>0&&(this.admin.environment().observedSky=!0);break}}handleConstruction(t){switch(t.id){case"buy-building":{const e=this.admin.building(t.building);e.orderStatus===Ke.EMPTY&&(e.orderStatus=Ke.ORDERED);break}}}handleResearch(t){switch(t.id){case"research-tech":{const e=this.admin.tech(t.tech);e.orderStatus===Ke.EMPTY&&(e.orderStatus=Ke.ORDERED)}}}handleSociety(t){switch(t.id){case"assign-job":{const e=this.admin.pops().withJob(void 0).first();e.state.job=t.job;break}case"unassign-job":{const e=this.admin.pops().withJob(t.job).first();e.state.job=void 0;break}}}handleWorkshop(t){const e=this.admin.recipe(t.recipe);e.orderStatus===Ke.EMPTY&&(e.orderStatus=Ke.ORDERED)}}n(2801);const rs=(t,e)=>e.some((e=>t instanceof e));let ss,os;function as(){return ss||(ss=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function cs(){return os||(os=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ls=new WeakMap,us=new WeakMap,ds=new WeakMap,hs=new WeakMap,fs=new WeakMap;function ps(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(ys(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&ls.set(e,t)})).catch((()=>{})),fs.set(e,t),e}function ms(t){if(us.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));us.set(t,e)}let vs={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return us.get(t);if("objectStoreNames"===e)return t.objectStoreNames||ds.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ys(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function bs(t){vs=t(vs)}function ws(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?cs().includes(t)?function(...e){return t.apply(_s(this),e),ys(ls.get(this))}:function(...e){return ys(t.apply(_s(this),e))}:function(e,...n){const i=t.call(_s(this),e,...n);return ds.set(i,e.sort?e.sort():[e]),ys(i)}}function gs(t){return"function"===typeof t?ws(t):(t instanceof IDBTransaction&&ms(t),rs(t,as())?new Proxy(t,vs):t)}function ys(t){if(t instanceof IDBRequest)return ps(t);if(hs.has(t))return hs.get(t);const e=gs(t);return e!==t&&(hs.set(t,e),fs.set(e,t)),e}const _s=t=>fs.get(t);function ks(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=ys(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(ys(o.result),t.oldVersion,t.newVersion,ys(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}const Es=["get","getKey","getAll","getAllKeys","count"],xs=["put","add","delete","clear"],Ss=new Map;function js(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(Ss.get(e))return Ss.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=xs.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Es.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return Ss.set(e,s),s}async function Os(t,e){const n=t;n.createObjectStore("general"),n.createObjectStore("saves",{autoIncrement:!0})}async function Ts(t,e){}async function Rs(t,e){const n=e,i=n.objectStore("saves");let r=await i.openCursor();while(r){const t=r.value,e=t.state.buildings??{};for(const n of Object.values(e))n.unlocked=n.level>0;await r.update(t),r=await r.continue()}}async function Ms(t,e){const n=e,i=n.objectStore("saves");let r=await i.openCursor();while(r){const t=r.value,e=t.state.resources;if(e)for(const n of Object.values(e))n.unlocked=n.amount>0;await r.update(t),r=await r.continue()}}async function Ps(t,e){const n=e,i=n.objectStore("saves");let r=await i.openCursor();while(r){const t=r.value,{state:e}=t,n=e.society;n&&(e.stockpiles={"kitten-growth":{amount:n.stockpile}}),delete e.society,await r.update(t),r=await r.continue()}}async function Cs(t,e){}bs((t=>({...t,get:(e,n,i)=>js(e,n)||t.get(e,n,i),has:(e,n)=>!!js(e,n)||t.has(e,n)})));const Ds="os-data",Is=6,As=[{version:1,run:Os},{version:2,run:Ts},{version:3,run:Rs},{version:4,run:Ms},{version:5,run:Ps},{version:6,run:Cs}];async function Ns(t,e,n,i){let r=As.filter((t=>e<t.version));null!==n&&(r=r.filter((t=>t.version<=n)));for(const s of r)await s.run(t,i)}class Ls extends Error{constructor(){super("database not initialized")}}class Fs extends Error{constructor(t){super(`save slot ${t} does not exist`),x(this,"id",void 0),this.id=t}}class zs extends Error{constructor(t,e,n){super(`expected save slot ${t} to have version ${e} but found ${n} instead`),x(this,"id",void 0),x(this,"expected",void 0),x(this,"actual",void 0),this.id=t,this.expected=e,this.actual=n}}function Us(){return ks(Ds,Is,{async upgrade(t,e,n,i){if(null!==n&&n<Is)throw new Error("tried to migrate to version older than latest");await Ns(t,e,n,i)}})}async function Bs(){const t=await Us(),e=t.transaction("saves","readwrite"),n=await e.store.add({version:1,state:{}});return await e.done,n}async function $s(){const t=await Us(),e=t.transaction("general","readwrite");let n=await e.store.get("general");return void 0===n&&(n={},await e.store.put(n,"general")),await e.done,n}async function qs(t){const e=await Us(),n=e.transaction("general","readwrite"),i=await n.store.get("general");if(void 0===i)throw new Ls;i.currentSlot=t,await n.store.put(i,"general"),await n.done}async function Ws(t){const e=await Us(),n=await e.get("saves",t);if(!n)throw new Fs(t);return n}async function Ys(t,e){const n=await Us(),i=n.transaction("saves","readwrite",{durability:"strict"}),r=await i.store.get(t);if(!r)throw new Fs(t);if(r.version!==e.version)throw new zs(t,e.version,r.version);e.version++,i.store.put(e,t),await i.done}class Hs{constructor(t){x(this,"admin",void 0),x(this,"version",void 0),this.admin=t,this.version=0}load(t){this.version=t.version,this.admin.loadState(t.state)}async save(){const t={version:this.version,state:{}};this.admin.saveState(t.state);const e=await $s();if(void 0===e.currentSlot)throw new Error("Save slot not set.");await Ys(e.currentSlot,t),this.version=t.version}}class Vs{constructor(t){x(this,"handlers",void 0),x(this,"queue",new Xr.c),this.handlers=t}enqueue(t){this.queue.enqueue(t)}consume(t){const{apply:e,success:n,failure:i}=this.handlers,r=new M;for(const{id:s,delta:o}of t.resources())r.addDelta(s,o);for(const s of this.consumeOrders()){const o=new M(r),a={admin:t,transaction:o,order:s},c=this.applyOrder(a,e);if(c.success){for(const[e,n]of o.deltas()){const i=t.resource(e);i.delta.addDelta(n)}o.merge(!0),n&&n(a)}else i&&i(a)}r.clear()}*consumeOrders(){let t;while(t=this.queue.dequeue())yield t}applyOrder(t,e){try{return e(t)}catch(n){return console.log(n),"string"===typeof n?{success:!1,ErrorMessage:n}:{success:!1,ErrorMessage:`Internal error: ${n}`}}}}class Gs{constructor(t){x(this,"admin",void 0),this.admin=t}}class Ks extends Gs{update(){const{ticks:t,days:e}=this.admin.time(),n=this.admin.stockpile("observe-sky").state;if(n.amount>0){const e=this.admin.environment();e.observedSky?(e.observedSky=!1,n.amount=0,this.observedRareEvent()):t.wholeTicks>0&&n.amount--}e.wholeTicks>0&&this.handleCelestialEvents()}handleCelestialEvents(){const t=this.admin.boolean("unlock.section.science").getOr(!1);if(t){{const t=1/400,e=this.admin.prng().astronomy();if(e<t){this.admin.history().push(fr("astronomy.rare-event"));const t=this.admin.stockpile("observe-sky").state;t.amount=300}}if(this.admin.tech("mining").state.researched){const t=.001,e=this.admin.prng().astronomy();e<t&&this.minedFallenMeteor()}}}observedRareEvent(){const t=this.admin.number("astronomy.rare-event.reward").getOr(25);this.admin.transactions().enqueue({debits:Xi.fromObject({science:t}),onFulfilled:t=>{const e=t.get("science")??0;e>0?this.admin.history().push(fr("astronomy.observed-sky-reward.gained",{scienceAmount:e})):this.admin.history().push(fr("astronomy.observed-sky-reward.capped"))}})}minedFallenMeteor(){const t=this.admin.number("minerals.ratio").getOr(0),e=50+25*t;this.admin.transactions().enqueue({debits:Xi.fromObject({minerals:e}),onFulfilled:t=>{const e=t.get("minerals")??0;e>0?this.admin.history().push(fr("astronomy.fallen-meteor-reward.gained-minerals",{mineralsAmount:e})):this.admin.history().push(fr("astronomy.fallen-meteor-reward.capped"))}})}}function Qs(t,e,n){let i=0,r=0;for(const c of t)c.frequency?i+=c.frequency:r++;if(i>e)throw new Error("The sum of the specified frequencies must not exceed the specified total.");let s=0;r>0&&(s=(e-i)/r);const o=n()*e;let a=0;for(const c of t){const t=void 0!==c.frequency?c.frequency:s;if(o<a+t)return c.result;a+=t}return t[t.length-1].result}class Js extends Gs{init(){Yn((()=>{const t=this.admin.tech("calendar").state,e=this.admin.environment().state;e.epochLabel=t.researched?"calendar.epoch.full":"calendar.epoch.basic"})),Yn((()=>{const t=this.admin.environment().state,e=this.admin.tech("calendar").state,n="neutral"!==t.weather;e.researched?t.calendarLabel=n?"calendar.full.weather":"calendar.full.no-weather":t.calendarLabel=n?"calendar.basic.weather":"calendar.basic.no-weather"}))}update(){const t=this.admin.environment().state;let e=t.day;const{days:n}=this.admin.time();if(n.wholeTicks>0){if(e+=1,e>=gr.DaysPerSeason){e=0;const n=this.calculateNextSeason(t.season);t.season=n;let i=t.year;"spring"===n&&(t.year=++i),i>3&&(t.weather=this.chooseWeather())}t.day=e}}calculateNextSeason(t){switch(t){case"spring":return"summer";case"summer":return"autumn";case"autumn":return"winter";case"winter":return"spring"}}chooseWeather(){return Qs([{frequency:175,result:"cold"},{frequency:175,result:"warm"},{result:"neutral"}],1e3,(()=>this.admin.prng().environment()))}}class Xs extends Gs{constructor(t){super(t)}init(){this.resolveEffectValues()}update(){}resolveEffectValues(){const t=new Zs(this.admin);t.resolveExprs(this.admin.booleans().map((t=>t.id)),{expr:t=>Xe[t],get:t=>this.admin.boolean(t).getOr(!1),set:(t,e)=>{this.admin.boolean(t).set(e)}}),t.resolveExprs(this.admin.numbers().map((t=>t.id)),{expr:t=>fn[t],get:t=>this.admin.number(t).get(),set:(t,e)=>{this.admin.number(t).set(e)},addTreeNode:(t,e)=>{R(this.admin.effectTree().state,t,(()=>new Set)).add(e)}})}}class Zs{constructor(t){x(this,"admin",void 0),x(this,"resolved",new Set),x(this,"resolving",new Set),this.admin=t}resolveExprs(t,e){this.resolved.clear(),this.resolving.clear();for(const n of t)this.resolveExpr(n,e)}resolveExpr(t,e){if(!this.resolved.has(t)){if(this.resolving.has(t))throw console.log(this.resolving),new to(t,"cycle detected");this.resolving.add(t),Yn((()=>e.set(t,this.unwrap(t,e)))),this.resolving.delete(t),this.resolved.add(t)}}unwrap(t,e){const n=e.expr(t);return n instanceof Function?n({admin:this.admin,val:n=>(this.resolveExpr(n,e),e.addTreeNode?.(t,n),e.get(n))}):n}}class to extends Error{constructor(t,e){super(`could not resolve value for effect '${t}': ${e}`),x(this,"id",void 0),x(this,"reason",void 0),this.id=t,this.reason=e}}class eo extends Gs{init(){for(const{id:t,meta:e,state:n}of this.admin.buildings()){const i=e.prices.base,r=e.prices.ratio,s=this.admin.fulfillment(t).state;for(const t of s.ingredients){const e=i[t.resourceId];Yn((()=>{t.requirement=e*Math.pow(r,n.level)}))}}}update(){for(const{state:t}of this.admin.fulfillments()){let e=!1,n=!0;const i=t.ingredients;for(const t of i){const i=this.admin.resource(t.resourceId).state,{amount:r,change:s,capacity:o}=i;let a,c=!1;const l=t.requirement;r>=l?c=!0:s>0&&(a=void 0!==o&&o<l?Number.POSITIVE_INFINITY:(l-r)/s),t.fulfillment=r,t.fulfillmentTime=a,t.fulfilled=c,n&&=c;const u=!c&&void 0!==o&&l>o;e||=u,t.capped=u}t.fulfilled=n,t.capped=!n&&e}}}class no extends Gs{init(){for(const t of tr.techs())Yn((()=>{const e=this.admin.tech(t.id).state;if(!e.unlocked){for(const e of t.dependsOn)if(!this.admin.tech(e).state.researched)return;e.unlocked=!0}}))}update(){for(const t of this.unlockables())this.applyUnlockEffect(t);for(const t of this.admin.resources())this.updateResourceUnlocked(t);for(const t of this.admin.buildings())this.updateBuildingUnlocked(t)}*unlockables(){for(const t of this.admin.sections())yield t;for(const t of this.admin.jobs())yield t}applyUnlockEffect(t){const{state:e,meta:n}=t,i=n.unlockEffect;e.unlocked||void 0===i||(e.unlocked=this.admin.boolean(i).getOr(!1))}updateResourceUnlocked(t){const{state:e,meta:n}=t;if(!e.unlocked){const t=n.unlockMode??mr.FirstQuantity;switch(t){case mr.FirstQuantity:e.amount>0&&(e.unlocked=!0);break;case mr.FirstCapacity:e.capacity&&(e.unlocked=!0);break}}}updateBuildingUnlocked(t){const{state:e,meta:n}=t;if(!e.unlocked){const i=n.unlock;if(void 0===i)return void(e.unlocked=!0);const r=i.unlockEffect;if(void 0!==r&&!this.admin.boolean(r).getOr(!1))return;const s=i.priceRatio;if(void 0===s)return void(e.unlocked=!0);const o=this.admin.fulfillment(t.id).state;for(const t of o.ingredients){const n=t.requirement*s;if(t.fulfillment>=n)return void(e.unlocked=!0)}}}}class io extends Gs{constructor(...t){super(...t),x(this,"growthPerTick",.01),x(this,"starvationPerTick",-.2)}init(){Yn((()=>{const t=this.admin.resource("kittens").state;t.amount=this.admin.pops().size}))}update(){this.updatePops(),this.updateStockpile()}updatePops(){const t=this.admin.stockpile("kitten-growth").state,e=Nr(t.amount);if(e>=1){const n=e;this.admin.pops().grow(n),t.amount-=n,this.kittensArrived(n)}else if(e<=-1){const n=Math.abs(e);this.admin.pops().kill(n),t.amount+=n,this.kittensStarved(n)}}kittensArrived(t){const e=pr("population.kitten.arrived",t,{count:t});this.admin.pops().size>10&&(e.disposition="ignore"),this.admin.history().push(e)}kittensStarved(t){const e=pr("population.kitten.starved",t,{count:t});this.admin.history().push(e)}updateStockpile(){const t=this.admin.time().ticks.delta,e=this.admin.stockpile("kitten-growth").state,n=this.admin.resource("catnip").state.amount,i=this.admin.resource("kittens").state,r=i.amount,s=i.capacity??0;if(n>0&&r<s){const n=Math.max(0,e.amount);e.amount=n+t*this.growthPerTick}else if(0==n&&r>0){const n=Math.min(0,e.amount);e.amount=n+t*this.starvationPerTick}else e.amount=0}}class ro extends Gs{constructor(t){super(t)}init(){Yn((()=>{for(const{meta:t,state:e}of this.admin.resources()){const n=t.effects.delta;n&&(e.change=this.admin.number(n).getOr(0))}}))}update(){const t=this.admin.time().ticks.delta;for(const{state:e,delta:n}of this.admin.resources()){const i=t*e.change;i>0?n.addDebit(i):i<0&&n.addCredit(Math.abs(i)),e.amount=this.calculateAmount(e.amount,e.capacity??Number.POSITIVE_INFINITY,n.debit,n.credit),n.reset()}}calculateAmount(t,e,n,i){let r=t-i;return r<e&&(r+=n,r=Math.min(r,e)),r=Math.max(r,0),r}}class so extends Gs{constructor(t){super(t)}init(){Yn((()=>{for(const{state:t,meta:e}of this.admin.resources()){const n=e.effects.limit;n&&(t.capacity=this.admin.number(n).get())}}))}update(){}}class oo extends Gs{init(){Yn((()=>{const t=this.admin.pops(),e=this.admin.section("society").state;e.label=this.societyLabel(t.size),e.alert=this.societyAlert(t.withJob(void 0).count())}))}update(){}societyLabel(t){switch(!0){case 0===t:return"sections.society.outpost";case t<5:return"sections.society.small-village";default:return"sections.society.village"}}societyAlert(t){switch(!0){case 0===t:return;case t<100:return t.toFixed(0);default:return"99+"}}}class ao extends Gs{init(){Yn((()=>{const t=this.admin.player().state.timeAcceleration;this.admin.time().state.millisPerTick=gr.MillisPerTick/Math.pow(10,t)}))}update(t){const e=this.admin.time(),n=e.state.millisPerTick;for(const i of e.timers()){i.delta=t/(i.period*n);const e=i.absolute;i.absolute=Ar(i.absolute+i.delta,3),i.wholeTicks=Math.floor(i.absolute)-Math.floor(e)}}}class co extends Gs{constructor(...t){super(...t),x(this,"transactions",new Vs({apply:lo,success:({order:t})=>t.onFulfilled(t.fulfillment)})),x(this,"crafting",new Vs({apply:fo})),x(this,"research",new Vs({apply:uo,success:({order:t})=>{t.state.researched=!0}})),x(this,"construction",new Vs({apply:ho,success:({order:t})=>{t.state.level++}}))}update(){for(const e of this.admin.transactions().all())this.transactions.enqueue({...e,fulfillment:new Xi});this.transactions.consume(this.admin);const t=this.admin.time().ticks.wholeTicks>0;this.processOrdered(this.crafting,this.admin.recipes(),t),this.processOrdered(this.research,this.admin.techs(),t),this.processOrdered(this.construction,this.admin.buildings(),t)}processOrdered(t,e,n){for(const i of e)i.orderStatus===Ke.ORDERED?(t.enqueue(i),i.orderStatus=Ke.READY):n&&i.orderStatus===Ke.READY&&(i.orderStatus=Ke.EMPTY);t.consume(this.admin)}}function lo(t){const{order:e,transaction:n,admin:i}=t;for(const[r,s]of e.credits??[]){n.addCredit(r,s);const{amount:t}=i.resource(r).state;if(t<s)return{success:!1,ErrorMessage:`Could not complete transaction because we needed more '${r}'.`}}for(const[r,s]of e.debits??[]){n.addDebit(r,s);const{amount:t,capacity:o}=i.resource(r).state;if(o){const i=n.getDebit(r),s=n.getCredit(r),a=t+i-s;e.fulfillment.set(r,Math.min(o,a)-t)}else e.fulfillment.set(r,s)}return{success:!0}}function uo(t){const{order:e,transaction:n,admin:i}=t,r=i.fulfillment(e.id);for(const{resourceId:s,requirement:o}of r.state.ingredients){n.addCredit(s,o);const t=i.resource(s).state,r=n.getDebit(s),a=n.getCredit(s),c=t.amount+r-a;if(c<0)return{success:!1,ErrorMessage:`Could not research '${e.id}' because we needed more '${s}' to satisfy it.`}}return{success:!0}}function ho(t){const{order:e,transaction:n,admin:i}=t,r=i.fulfillment(e.id);for(const{resourceId:s,requirement:o}of r.state.ingredients){n.addCredit(s,o);const t=i.resource(s).state,r=n.getDebit(s),a=n.getCredit(s),c=t.amount+r-a;if(c<0)return{success:!1,ErrorMessage:`Could not craft '${e.id}' because we needed more '${s}' to satisfy it.`}}return{success:!0}}function fo(t){const{order:e,transaction:n,admin:i}=t,r=i.fulfillment(e.id);for(const{resourceId:c,requirement:l}of r.state.ingredients)if(n.addCredit(c,l),!po(t,c))return{success:!1,ErrorMessage:`Could not craft '${e}' because we needed more '${c}' to satisfy it.`};const s=i.recipe(e.id);let o=!0;const a=s.state.products;for(const[c,l]of a.entries())n.addDebit(c,l),o=o&&mo(t,c);return o?{success:!1,ErrorMessage:`Could not craft '${e.id}' because there's no space for the crafted materials.`}:{success:!0}}function po(t,e){const{transaction:n,admin:i}=t,{amount:r}=i.resource(e).state,s=n.getDebit(e),o=n.getCredit(e);return r+s-o>=0}function mo(t,e){const{transaction:n,admin:i}=t,{amount:r,capacity:s}=i.resource(e).state;if(!s)return!1;const o=n.getDebit(e),a=n.getCredit(e),c=r+o-a;return c>=s&&r>=s}class vo{constructor(t){x(this,"astronomy",void 0),x(this,"effects",void 0),x(this,"environment",void 0),x(this,"fulfillment",void 0),x(this,"lockToggle",void 0),x(this,"population",void 0),x(this,"resourceAmounts",void 0),x(this,"resourceLimits",void 0),x(this,"sections",void 0),x(this,"time",void 0),x(this,"workOrders",void 0),this.astronomy=new Ks(t),this.effects=new Xs(t),this.environment=new Js(t),this.fulfillment=new eo(t),this.lockToggle=new no(t),this.population=new io(t),this.resourceAmounts=new ro(t),this.resourceLimits=new so(t),this.sections=new oo(t),this.time=new ao(t),this.workOrders=new co(t)}init(){for(const t of this.systems())t.init?.()}update(t){this.time.update(t),this.astronomy.update(),this.environment.update(),this.workOrders.update(),this.effects.update(),this.population.update(),this.sections.update(),this.resourceLimits.update(),this.resourceAmounts.update(),this.fulfillment.update(),this.lockToggle.update()}*systems(){for(const t of Object.keys(this)){const e=this[t];e instanceof Gs&&(yield e)}}}class bo{constructor(t,e,n){x(this,"admin",void 0),x(this,"watcher",void 0),x(this,"systems",void 0),x(this,"onTickedHandler",void 0),x(this,"onLogEventHandler",void 0),x(this,"interactor",void 0),this.onTickedHandler=t,this.onLogEventHandler=e,this.watcher=new Hi,this.admin=new pn(this.watcher);const i=new es(this.admin,(t=>this.update(t)),(()=>this.render()),new S);this.interactor=new ts(i,this.admin),this.interactor.store.load(n),this.systems=new vo(this.admin),this.systems.init(),this.update(0),this.render()}update(t){this.systems.update(t)}render(){this.watcher.flushMutations((t=>{this.onTickedHandler(t)})),this.watcher.flushEvents((t=>{this.onLogEventHandler(t)}))}}async function wo(t){t||(t=await Bs());const e=await Ws(t);return await qs(t),e}let go;const yo={async initialize(t,e,n){void 0!==go&&go.interactor.controller.stop();const i=await wo(n);go=new bo(t,e,i)},start(){go.interactor.controller.start()},stop(){go.interactor.controller.stop()},async save(){await go.interactor.store.save()},async send(t){await go.interactor.dispatcher.send(t)},turnDevToolsOn(){go.interactor.devTools.turnDevToolsOn()},turnDevToolsOff(){go.interactor.devTools.turnDevToolsOff()},setGatherCatnip(t){go.interactor.devTools.setGatherCatnip(t)},setTimeAcceleration(t){go.interactor.devTools.setTimeAcceleration(t)}};l(yo)}()})();
//# sourceMappingURL=946.13939c0b.js.map