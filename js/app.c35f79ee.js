(function(){"use strict";var e={3940:function(e,t,i){function n(e,t){for(const i of e)if(!1===t(i))return!1;return!0}function r(e,t){for(const i of e)if(!0===t(i))return!0;return!1}function o(e,t){let i=0;for(const n of e)!0===t(n)&&i++;return i}function s(e,t,i){let n=e.get(t);return void 0===n&&(n=i(t),e.set(t,n)),n}i.d(t,{$6:function(){return n},$7:function(){return s},QX:function(){return o},Yj:function(){return r}})},698:function(e,t,i){i.d(t,{J:function(){return o},e:function(){return r}});i(1703);var n=i(3396);const r=Symbol("GameEndpoint");function o(e){const t=(0,n.f3)(r);if(void 0===t)throw new Error("could not inject endpoint");return e(t.value)}},4737:function(e,t,i){i.d(t,{j:function(){return s},y:function(){return o}});var n=i(4870),r=i(3396);const o=Symbol("KeyboardEvents");function s(){const e=(0,n.qj)({ctrl:!1,shift:!1,alt:!1}),t=t=>{e.ctrl=t.ctrlKey,e.shift=t.shiftKey,e.alt=t.altKey},i=()=>{"hidden"===document.visibilityState&&(e.ctrl=!1,e.shift=!1,e.alt=!1)};return(0,r.bv)((()=>{addEventListener("keydown",t),addEventListener("keyup",t),document.addEventListener("visibilitychange",i)})),(0,r.Ah)((()=>{removeEventListener("keydown",t),removeEventListener("keyup",t),document.removeEventListener("visibilitychange",i)})),(0,n.OT)(e)}},1825:function(e,t,i){var n=i(9242),r=i(3396),o=i(4870),s=i(9212),a=i(2482);class l{constructor(e){(0,a.Z)(this,"manager",void 0),(0,a.Z)(this,"bonfire",void 0),(0,a.Z)(this,"environment",void 0),(0,a.Z)(this,"formatter",void 0),(0,a.Z)(this,"log",void 0),(0,a.Z)(this,"player",void 0),(0,a.Z)(this,"resources",void 0),(0,a.Z)(this,"science",void 0),(0,a.Z)(this,"sections",void 0),(0,a.Z)(this,"society",void 0),this.manager=e,this.bonfire=new B(this.manager),this.environment=new U(this.manager),this.log=new Y(this.manager),this.player=new J(this.manager),this.resources=new K(this.manager),this.science=new Q(this.manager),this.sections=new V(this.manager),this.society=new $(this.manager),this.formatter=new H(this.manager,{precision:3,units:"seconds"})}}Map;i(1703);var c=i(3940);let u;const d=e=>!0;u=Symbol.iterator;class f{constructor(e){(0,a.Z)(this,"iterator",void 0),this.iterator=e}[u](){return this.iterator}toArray(){return Array.from(this)}toMap(e,t){return new Map(this.map((i=>[e(i),t(i)])))}map(e){const t=this;return new f(function*(){for(const i of t)yield e(i)}())}flatMap(e){const t=this;return new f(function*(){for(const i of t)for(const t of e(i))yield t}())}all(e){return(0,c.$6)(this,e??d)}any(e){return(0,c.Yj)(this,e??d)}count(e){return(0,c.QX)(this,e??d)}first(){for(const e of this.take(1))return e;throw new Error("Expected at least one item but iterable was empty.")}take(e){const t=this;return new f(function*(){let i=0;for(const n of t){if(i++>=e)break;yield n}}())}filter(e){const t=this;return new f(function*(){for(const i of t)e(i)&&(yield i)}())}defined(){const e=this;return new f(function*(){for(const t of e)void 0!==t&&(yield t)}())}reduce(e,t){let i=e;for(const n of this)i=t(i,n);return i}}function p(e){function*t(){for(const t of e)yield t}return new f(t())}const b={bonfireItems(){return p(h)},buildings(){return p(Object.values(m))},building(e){return m[e]},effectDisplay(e){return w[e]},jobs(){return p(Object.values(S))},job(e){return S[e]},recipes(){return p(Object.values(v))},resources(){return p(Object.values(T))},resource(e){return T[e]},season(e){return F[e]},sections(){return p(Object.values(C))},section(e){return C[e]},techs(){return p(Object.values(A))},tech(e){return A[e]},weather(e){return O[e]}},h=["gather-catnip","refine-catnip","catnip-field","hut","library","barn","mine"],m={"catnip-field":{id:"catnip-field",label:"buildings.catnip-field.label",description:"buildings.catnip-field.description",flavor:"buildings.catnip-field.flavor",prices:{ratio:1.12,base:{catnip:10}},unlock:{priceRatio:.3},effects:[{id:"catnip",per:"catnip-field.catnip.base",total:"catnip-field.catnip",label:"buildings.catnip-field.effects.catnip"}]},hut:{id:"hut",label:"buildings.hut.label",description:"buildings.hut.description",flavor:"buildings.hut.flavor",prices:{ratio:2.5,base:{wood:5}},unlock:{priceRatio:.3},effects:[{id:"kittens-limit",per:"hut.kittens-limit.base",total:"hut.kittens-limit",label:"buildings.hut.effects.kittens-limit"},{id:"catpower-limit",per:"hut.catpower-limit.base",total:"hut.catpower-limit",label:"buildings.hut.effects.catpower-limit"}]},library:{id:"library",label:"buildings.library.label",description:"buildings.library.description",flavor:"buildings.library.flavor",prices:{base:{wood:25},ratio:1.15},unlock:{priceRatio:.3},effects:[{id:"science-limit",per:"library.science-limit.base",total:"library.science-limit",label:"buildings.library.effects.science-limit"},{id:"science-ratio",per:"library.science-ratio.base",total:"library.science-ratio",label:"buildings.library.effects.science-ratio"}]},barn:{id:"barn",label:"buildings.barn.label",description:"buildings.barn.description",flavor:"buildings.barn.flavor",unlock:{priceRatio:.3,unlockEffect:"unlock.building.barn"},prices:{base:{wood:50},ratio:1.75},effects:[{id:"catnip-limit",per:"barn.catnip-limit.base",total:"barn.catnip-limit",label:"buildings.barn.effects.catnip-limit"},{id:"wood-limit",per:"barn.wood-limit.base",total:"barn.wood-limit",label:"buildings.barn.effects.wood-limit"},{id:"minerals-limit",per:"barn.minerals-limit.base",total:"barn.minerals-limit",label:"buildings.barn.effects.minerals-limit"}]},mine:{id:"mine",label:"buildings.mine.label",description:"buildings.mine.description",flavor:"buildings.mine.flavor",unlock:{priceRatio:.15,unlockEffect:"unlock.building.mine"},prices:{base:{wood:100},ratio:1.15},effects:[{id:"mineral-ratio",per:"mine.minerals-ratio.base",total:"mine.minerals-ratio",label:"buildings.mine.effects.minerals-ratio"}]}},v={"refine-catnip":{id:"refine-catnip",ingredients:{catnip:100},products:{wood:1}}};Map;var g;(function(e){e[e["None"]=0]="None",e[e["Tick"]=1]="Tick",e[e["PerTick"]=2]="PerTick",e[e["Percent"]=3]="Percent"})(g||(g={}));const w={"catnip.delta":k("inline"),"catnip.production":k("inline"),"catnip-field.catnip":{...k("collapse"),label:"effect-tree.catnip-fields"},"catnip-field.catnip.base":k(),"weather.ratio":{...j("collapse"),label:"effect-tree.weather"},"weather.season-ratio":j(),"weather.severity-ratio":j(),"jobs.farmer.catnip":{...k("collapse"),label:"effect-tree.farming"},"jobs.farmer.catnip.base":k(),"population.catnip-demand":{...k("collapse"),label:"effect-tree.village-demand",invert:!0},"population.catnip-demand.base":{...k(),invert:!0},"wood.delta":k("inline"),"wood.production":k("inline"),"jobs.woodcutter.wood":{...k("collapse"),label:"effect-tree.woodcutting"},"jobs.woodcutter.wood.base":k(),"minerals.delta":k("inline"),"minerals.production":k("inline"),"jobs.miner.minerals":{...k("collapse"),label:"effect-tree.mining"},"jobs.miner.minerals.base":k(),"minerals.ratio":{...j("collapse"),label:"effect-tree.bonus"},"mine.minerals-ratio":j(),"mine.minerals-ratio.base":j(),"science.delta":k("inline"),"science.production":k("inline"),"jobs.scholar.science":{...k("collapse"),label:"effect-tree.researching"},"jobs.scholar.science.base":k(),"science.ratio":{...j("collapse"),label:"effect-tree.bonus"},"library.science-ratio":j(),"library.science-ratio.base":j(),"astronomy.rare-event.reward":y(),"astronomy.rare-event.reward.base":y(),"catpower.delta":k("inline"),"catpower.production":k("inline"),"jobs.hunter.catpower.base":k(),"jobs.hunter.catpower":k(),"population.happiness.total":j("collapse"),"population.happiness.base":{...j(),label:"effect-tree.base"},"population.overpopulation":{...j("collapse"),label:"effect-tree.overpopulation"},"population.overpopulation.base":j(),"population.overpopulation.severity":j(),"catnip.limit":y("inline"),"catnip.limit.base":y(),"barn.catnip-limit":y("inline"),"barn.catnip-limit.base":y(),"wood.limit":y("inline"),"wood.limit.base":y(),"barn.wood-limit":y("inline"),"barn.wood-limit.base":y(),"minerals.limit":y("inline"),"minerals.limit.base":y(),"barn.minerals-limit":y("inline"),"barn.minerals-limit.base":y(),"science.limit":y("inline"),"library.science-limit":y("collapse"),"library.science-limit.base":y(),"catpower.limit":y("inline"),"catpower.limit.base":y(),"hut.catpower-limit":y("collapse"),"hut.catpower-limit.base":y(),"kittens.limit":y("inline"),"hut.kittens-limit":y("collapse"),"hut.kittens-limit.base":y()};function y(e){return e?{unit:g.None,disposition:e}:{unit:g.None}}function k(e){return e?{unit:g.PerTick,disposition:e}:{unit:g.PerTick}}function j(e){return e?{unit:g.Percent,disposition:e}:{unit:g.Percent}}const F={spring:{id:"spring",label:"environment.seasons.spring.label"},summer:{id:"summer",label:"environment.seasons.summer.label"},autumn:{id:"autumn",label:"environment.seasons.autumn.label"},winter:{id:"winter",label:"environment.seasons.winter.label"}},O={neutral:{id:"neutral"},warm:{id:"warm",label:"environment.weather.warm"},cold:{id:"cold",label:"environment.weather.cold"}},S={woodcutter:{id:"woodcutter",label:"jobs.woodcutter.label",description:"jobs.woodcutter.description",flavor:"jobs.woodcutter.flavor",effects:[{id:"wood",label:"jobs.woodcutter.effects.wood",base:"jobs.woodcutter.wood.base",total:"jobs.woodcutter.wood"}]},farmer:{id:"farmer",label:"jobs.farmer.label",description:"jobs.farmer.description",unlockEffect:"unlock.job.farmer",effects:[{id:"catnip",label:"jobs.farmer.effects.catnip",base:"jobs.farmer.catnip.base",total:"jobs.farmer.catnip"}]},scholar:{id:"scholar",label:"jobs.scholar.label",description:"jobs.scholar.description",unlockEffect:"unlock.job.scholar",effects:[{id:"science",label:"jobs.scholar.effects.science",base:"jobs.scholar.science.base",total:"jobs.scholar.science"}]},hunter:{id:"hunter",label:"jobs.hunter.label",description:"jobs.hunter.description",unlockEffect:"unlock.job.hunter",effects:[{id:"catpower",label:"jobs.hunter.effects.catpower",base:"jobs.hunter.catpower.base",total:"jobs.hunter.catpower"}]},miner:{id:"miner",label:"jobs.miner.label",description:"jobs.miner.description",flavor:"jobs.miner.flavor",unlockEffect:"unlock.job.miner",effects:[{id:"minerals",label:"jobs.miner.effects.minerals",base:"jobs.miner.minerals.base",total:"jobs.miner.minerals"}]}};var E;(function(e){e[e["FirstQuantity"]=0]="FirstQuantity",e[e["FirstCapacity"]=1]="FirstCapacity"})(E||(E={}));const T={catnip:{id:"catnip",label:"resources.catnip.label",effects:{delta:"catnip.delta",limit:"catnip.limit"}},wood:{id:"wood",label:"resources.wood.label",effects:{limit:"wood.limit",delta:"wood.delta"}},minerals:{id:"minerals",label:"resources.minerals.label",effects:{limit:"minerals.limit",delta:"minerals.delta"}},catpower:{id:"catpower",label:"resources.catpower.label",effects:{delta:"catpower.delta",limit:"catpower.limit"}},science:{id:"science",label:"resources.science.label",effects:{delta:"science.delta",limit:"science.limit"}},kittens:{id:"kittens",label:"resources.kittens.label",unlockMode:E.FirstCapacity,effects:{limit:"kittens.limit"}}},C={bonfire:{id:"bonfire",label:"sections.bonfire.label"},society:{id:"society",label:"sections.society.label",unlockEffect:"unlock.section.society"},jobs:{id:"jobs",parent:"society",label:"sections.jobs.label"},management:{id:"management",parent:"society",label:"sections.management.label",unlockEffect:"unlock.section.management"},science:{id:"science",label:"sections.science.label",unlockEffect:"unlock.section.science"},technologies:{id:"technologies",parent:"science",label:"sections.technologies.label"}},A={calendar:{id:"calendar",label:"tech.calendar.label",description:"tech.calendar.description",flavor:"tech.calendar.flavor",ingredients:{science:30},effects:[{id:"default",label:"tech.calendar.effect"}],dependsOn:[]},agriculture:{id:"agriculture",label:"tech.agriculture.label",description:"tech.agriculture.description",flavor:"tech.agriculture.flavor",ingredients:{science:100},effects:[{id:"default",label:"tech.agriculture.effect"}],dependsOn:["calendar"]},archery:{id:"archery",label:"tech.archery.label",description:"tech.archery.description",flavor:"tech.archery.flavor",ingredients:{science:300},effects:[{id:"default",label:"tech.archery.effect"}],dependsOn:["agriculture"]},mining:{id:"mining",label:"tech.mining.label",description:"tech.mining.description",flavor:"tech.mining.flavor",ingredients:{science:500},effects:[{id:"default",label:"tech.mining.effect"}],dependsOn:["agriculture"]}};function Z(e,t){return(0,o.qj)({nodes:(0,r.Fl)((()=>Array.from(M(e,t))))})}function*M(e,t){const i=t.effectTree().get(e)??[];for(const n of i){const e=b.effectDisplay(n);switch(e.disposition){case"hide":continue;case"inline":yield*M(n,t);continue;default:yield(0,o.qj)({id:n,label:e.label,value:(0,r.Fl)((()=>D(t,n))),nodes:"collapse"===e.disposition?[]:Array.from(M(n,t))})}}}function I(e,t=0){return P(e,t,Math.round)}function P(e,t,i){const n=Math.pow(10,t),r=e*n,o=r*(1+Number.EPSILON);return i(o)/n}function q(e,t,i){return{limit:e,divisor:t,postfix:i}}const L=[q(1e210,1e210,"Q"),q(1e42,1e42,"W"),q(1e39,1e39,"L"),q(1e36,1e36,"F"),q(1e33,1e33,"H"),q(1e30,1e30,"S"),q(1e27,1e27,"U"),q(1e24,1e24,"Y"),q(1e21,1e21,"Z"),q(1e18,1e18,"E"),q(1e15,1e15,"P"),q(1e12,1e12,"T"),q(1e9,1e9,"G"),q(1e6,1e6,"M"),q(9e3,1e3,"K")];function _(e,t){const i=Math.sign(e);switch(t){case"negative":if(i<0)return"-";break;case"always":if(i>=0)return"+";if(i<0)return"-";break}return""}function x(e,t){let i="";for(const r of L){const n=I(e,t);Number.isFinite(n)&&(e=n);while(e+Number.EPSILON>=r.limit)i=r.postfix+i,e/=r.divisor}e=I(e,t);const n=Number.isInteger(e)?e.toFixed(0):e.toFixed(t);return n+i}const N=(e,t,i)=>{const n=_(e,i);let r;if(Number.isFinite(e)){const i=Math.abs(e);r=x(i,t)}else r=Number.POSITIVE_INFINITY.toString();return n+r};function D(e,t,i,n){return{value:e.number(t).value,style:w[t],showSign:i??"always",rounded:n??!1}}function R(e,t){const i=t.fulfillment(e);return(0,o.qj)({ingredients:Array.from(i.ingredients,(e=>(0,o.qj)({id:e.resourceId,label:b.resource(e.resourceId).label,requirement:(0,r.Fl)((()=>e.requirement)),fulfillment:(0,r.Fl)((()=>e.fulfillment)),fulfilled:(0,r.Fl)((()=>e.fulfilled)),fulfillmentTime:(0,r.Fl)((()=>W(e))),capped:(0,r.Fl)((()=>e.capped))}))),fulfilled:(0,r.Fl)((()=>i.fulfilled)),capped:(0,r.Fl)((()=>i.capped))})}function W(e){return void 0===e.fulfillmentTime?void 0:{value:e.fulfillmentTime,style:{unit:g.Tick},rounded:!0,showSign:"negative"}}class B{constructor(e){(0,a.Z)(this,"all",void 0),this.all=b.bonfireItems().map((t=>this.newBonfireItem(t,e))).toArray()}newBonfireItem(e,t){switch(e){case"gather-catnip":return this.gatherCatnip();case"refine-catnip":return this.refineCatnip(t);default:return this.buyBuilding(e,t)}}gatherCatnip(){return(0,o.qj)({id:"gather-catnip",intent:{kind:"bonfire",id:"gather-catnip"},label:"bonfire.gather-catnip.label",description:"bonfire.gather-catnip.description",unlocked:!0,fulfillment:{capped:!1,fulfilled:!0,ingredients:[]}})}refineCatnip(e){return(0,o.qj)({id:"refine-catnip",intent:{kind:"workshop",id:"craft-recipe",recipe:"refine-catnip"},label:"bonfire.refine-catnip.label",description:"bonfire.refine-catnip.description",flavor:"bonfire.refine-catnip.flavor",unlocked:!0,fulfillment:(0,r.Fl)((()=>R("refine-catnip",e)))})}buyBuilding(e,t){const i=b.building(e),n=t.building(i.id);return(0,o.qj)({id:e,intent:{kind:"construction",id:"buy-building",building:i.id},label:i.label,description:i.description,flavor:i.flavor,unlocked:(0,r.Fl)((()=>n.unlocked)),level:(0,r.Fl)((()=>n.level)),fulfillment:(0,r.Fl)((()=>R(i.id,t))),effects:(0,r.Fl)((()=>this.effects(i.id,t)))})}effects(e,t){const i=b.building(e).effects;return Array.from(i,(e=>(0,o.qj)({id:e.id,label:e.label,singleAmount:(0,r.Fl)((()=>D(t,e.per))),totalAmount:(0,r.Fl)((()=>D(t,e.total)))})))}}class U{constructor(e){(0,a.Z)(this,"calendar",void 0),this.calendar=this.newCalendar(e)}newCalendar(e){const t=e.environment();return(0,o.qj)({day:(0,r.Fl)((()=>t.day)),season:(0,r.Fl)((()=>t.season)),year:(0,r.Fl)((()=>t.year)),weather:(0,r.Fl)((()=>t.weather)),calendarLabel:(0,r.Fl)((()=>t.calendarLabel)),epochLabel:(0,r.Fl)((()=>t.epochLabel)),seasonLabel:(0,r.Fl)((()=>b.season(t.season).label)),weatherLabel:(0,r.Fl)((()=>b.weather(t.weather).label)),showObserveSky:(0,r.Fl)((()=>e.stockpile("observe-sky").amount>0))})}}class H{constructor(e,t){(0,a.Z)(this,"manager",void 0),(0,a.Z)(this,"options",void 0),(0,a.Z)(this,"fmt",N),this.manager=e,this.options=t}number(e,t="negative"){return this.fmt(e,this.options.precision,t)}percent(e,t="negative"){return this.fmt(100*e,this.options.precision,t)+"%"}rounded(e,t="negative"){return this.fmt(e,0,t)}v(e){if(void 0===e.value)return"";const t=!0===e.rounded?0:this.options.precision,i=e.showSign??"negative",n=!0===e.style.invert?-e.value:e.value;switch(e.style.unit){case g.Percent:return this.fmt(100*n,t,i)+"%";case g.Tick:return"ticks"===this.options.units?this.fmt(n,t,i)+"t":this.fmt(n/this.tps,t,i)+"s";case g.PerTick:return"ticks"===this.options.units?this.fmt(n,t,i)+"/t":this.fmt(n*this.tps,t,i)+"/s";case g.None:return this.fmt(n,t,i)}}get tps(){return 1e3/this.manager.time().millisPerTick}}class Y{constructor(e){(0,a.Z)(this,"eventId",0),e.history().subscribe((e=>{for(const t of e)"ignore"!==t.disposition&&document.dispatchEvent(new CustomEvent("onlogmessage",{detail:{id:this.eventId++,resolve:(e,i)=>G(e,i,t)}}))}))}}function G(e,t,i){const n=i.named??{};for(const r in n)if(Object.prototype.hasOwnProperty.call(i.named,r)){const e=n[r];"number"===typeof e&&(n[r]=t.number(e))}switch(i.kind){case"label":return e(i.label,n??{});case"plural-label":return e(i.label,n??{},i.plural);default:throw new Error("unexpected event kind")}}class J{constructor(e){(0,a.Z)(this,"state",void 0),this.state=(0,o.qj)({gatherCatnip:(0,r.Fl)((()=>e.player().gatherCatnip)),timeAcceleration:(0,r.Fl)((()=>e.player().timeAcceleration))})}}class K{constructor(e){(0,a.Z)(this,"all",void 0),this.all=b.resources().map((t=>this.newResource(t,e))).toArray()}newResource(e,t){const i=t.resource(e.id);return(0,o.qj)({id:e.id,label:e.label,unlocked:(0,r.Fl)((()=>i.unlocked)),amount:(0,r.Fl)((()=>i.amount)),change:(0,r.Fl)((()=>"kittens"!==e.id?this.resourceChange(i):this.kittensChange(t))),capacity:(0,r.Fl)((()=>i.capacity)),modifier:(0,r.Fl)((()=>"catnip"===e.id?D(t,"weather.ratio"):void 0)),deltaTree:(0,r.Fl)((()=>void 0!==e.effects.delta?Z(e.effects.delta,t):void 0))})}resourceChange(e){return{value:e.change,style:{unit:g.PerTick},showSign:"always"}}kittensChange(e){return{value:e.stockpile("kitten-growth").amount,style:{unit:g.Percent},showSign:"negative",rounded:!0}}}class Q{constructor(e){(0,a.Z)(this,"items",void 0),this.items=(0,r.Fl)((()=>e.techs().map((t=>this.newTechItem(t,e))).toArray()))}newTechItem(e,t){const i=b.tech(e),n=t.tech(e);return(0,o.qj)({...this.staticData(i),intent:{kind:"research",id:"research-tech",tech:i.id},unlocked:(0,r.Fl)((()=>n.unlocked)),researched:(0,r.Fl)((()=>n.researched)),fulfillment:(0,r.Fl)((()=>R(i.id,t))),effects:i.effects})}staticData(e){return{id:e.id,label:e.label,description:e.description,flavor:e.flavor}}}class V{constructor(e){(0,a.Z)(this,"bonfire",void 0),(0,a.Z)(this,"society",void 0),(0,a.Z)(this,"jobs",void 0),(0,a.Z)(this,"management",void 0),(0,a.Z)(this,"science",void 0),(0,a.Z)(this,"technologies",void 0),(0,a.Z)(this,"topLevelSections",void 0),this.bonfire=this.newSectionItem("bonfire",e),this.society=this.newSectionItem("society",e),this.jobs=this.newSectionItem("jobs",e),this.management=this.newSectionItem("management",e),this.science=this.newSectionItem("science",e),this.technologies=this.newSectionItem("technologies",e),this.topLevelSections=[this.bonfire,this.society,this.science]}newSectionItem(e,t){const i=b.section(e),n=t.section(e);return(0,o.qj)({id:e,parentId:i.parent,label:(0,r.Fl)((()=>n.label)),unlocked:(0,r.Fl)((()=>n.unlocked)),alert:(0,r.Fl)((()=>n.alert))})}}class ${constructor(e){(0,a.Z)(this,"pops",void 0),(0,a.Z)(this,"jobs",void 0),(0,a.Z)(this,"happiness",void 0),(0,a.Z)(this,"allowSendHunters",void 0),this.pops=(0,r.Fl)((()=>e.pops().map((([e,t])=>this.newPopItem(e,t))).toArray())),this.jobs=(0,r.Fl)((()=>e.jobs().map((([t,i])=>this.newJobItem(t,i,e))).toArray())),this.happiness=(0,o.qj)({view:(0,r.Fl)((()=>D(e,"population.happiness.total","negative"))),effectTree:Z("population.happiness.total",e)}),this.allowSendHunters=(0,r.Fl)((()=>e.tech("archery").researched))}newJobItem(e,t,i){const n=b.job(e);return(0,o.qj)({id:n.id,label:n.label,description:n.description,flavor:n.flavor,capped:!1,unlocked:(0,r.Fl)((()=>t.unlocked)),pops:(0,r.Fl)((()=>i.pops().count((([,e])=>e.job===n.id)))),effects:(0,r.Fl)((()=>this.effects(n.effects,i)))})}effects(e,t){return Array.from(e,(e=>(0,o.qj)({id:e.id,label:e.label,singleAmount:(0,r.Fl)((()=>D(t,e.base))),totalAmount:(0,r.Fl)((()=>D(t,e.total)))})))}newPopItem(e,t){return(0,o.qj)({id:e,job:t.job})}}var X=i(4806);class z{constructor(){(0,a.Z)(this,"items",[]),(0,a.Z)(this,"trigger",(0,o.ZM)(((e,t)=>{let i=!1;return{get(){return e(),i},set(e){i=e,i&&t()}}}))),this.trigger.value=!1}push(e){for(const t of e)this.items.push(t);this.trigger.value=!0}*pull(){const e=this.items.splice(0);this.trigger.value=!1;for(const t of e)yield t}subscribe(e){return(0,r.yX)((()=>{this.trigger.value&&e(this.pull())}))}}class ee extends Map{get buildings(){return this.ensure("buildings")}get fulfillments(){return this.ensure("fulfillments")}get jobs(){return this.ensure("jobs")}get numbers(){return this.ensure("numbers")}get pops(){return this.ensure("pops")}get recipes(){return this.ensure("recipes")}get resources(){return this.ensure("resources")}get sections(){return this.ensure("sections")}get stockpiles(){return this.ensure("stockpiles")}get techs(){return this.ensure("techs")}ensure(e){return(0,c.$7)(this,e,(()=>(0,o.qj)(new Map)))}}class te extends Map{get history(){return this.ensure("history")}ensure(e){return(0,c.$7)(this,e,(()=>new z))}}class ie{constructor(){(0,a.Z)(this,"pools",void 0),(0,a.Z)(this,"events",void 0),this.pools=new ee,this.events=new te}acceptMutations(e){for(const t of e){const e=this.pools.ensure(t.poolId);if(t.added)for(const[i,n]of t.added)e.set(i,(0,o.qj)(n));if(t.updated)for(const[i,n]of t.updated)ne(n,e.get(i));if(t.removed)for(const i of t.removed)e.delete(i)}}acceptEvents(e){for(const t of e){const e=this.events.ensure(t.id);e.push(t.events)}}buildings(){return p(this.pools.buildings.entries())}building(e){return this.pools.buildings.get(e)}fulfillment(e){return this.pools.fulfillments.get(e)}jobs(){return p(this.pools.jobs.entries())}job(e){return this.pools.jobs.get(e)}number(e){return this.pools.numbers.get(e)}pops(){return p(this.pools.pops.entries())}recipe(e){return this.pools.recipes.get(e)}resource(e){return this.pools.resources.get(e)}sections(){return p(this.pools.sections.entries())}section(e){return this.pools.sections.get(e)}stockpile(e){return this.pools.stockpiles.get(e)}techs(){return p(this.pools.techs.keys())}tech(e){return this.pools.techs.get(e)}effectTree(){const e=this.pools.ensure("singletons");return e.get("effect-tree")}environment(){const e=this.pools.ensure("singletons");return e.get("environment")}player(){const e=this.pools.ensure("singletons");return e.get("player")}time(){const e=this.pools.ensure("singletons");return e.get("time")}history(){return this.events.history}}function ne(e,t){return t=t??(0,o.qj)({}),(0,X.mergeWith)(t,e,((e,t,i,n)=>{void 0===t&&void 0!==e&&(n[i]=void 0)})),t}var re=i(2767);async function oe(e,t){const i=e;i.createObjectStore("general"),i.createObjectStore("saves",{autoIncrement:!0})}async function se(e,t){}async function ae(e,t){const i=t,n=i.objectStore("saves");let r=await n.openCursor();while(r){const e=r.value,t=e.state.buildings??{};for(const i of Object.values(t))i.unlocked=i.level>0;await r.update(e),r=await r.continue()}}async function le(e,t){const i=t,n=i.objectStore("saves");let r=await n.openCursor();while(r){const e=r.value,t=e.state.resources;if(t)for(const i of Object.values(t))i.unlocked=i.amount>0;await r.update(e),r=await r.continue()}}async function ce(e,t){const i=t,n=i.objectStore("saves");let r=await n.openCursor();while(r){const e=r.value,{state:t}=e,i=t.society;i&&(t.stockpiles={"kitten-growth":{amount:i.stockpile}}),delete t.society,await r.update(e),r=await r.continue()}}async function ue(e,t){}const de="os-data",fe=6,pe=[{version:1,run:oe},{version:2,run:se},{version:3,run:ae},{version:4,run:le},{version:5,run:ce},{version:6,run:ue}];async function be(e,t,i,n){let r=pe.filter((e=>t<e.version));null!==i&&(r=r.filter((e=>e.version<=i)));for(const o of r)await o.run(e,n)}Error;Error;Error;function he(){return(0,re.X3)(de,fe,{async upgrade(e,t,i,n){if(null!==i&&i<fe)throw new Error("tried to migrate to version older than latest");await be(e,t,i,n)}})}async function me(){const e=await he(),t=e.transaction("general","readwrite");let i=await t.store.get("general");return void 0===i&&(i={},await t.store.put(i,"general")),await t.done,i}let ve;async function ge(){ve?.();const e=new Worker(new URL(i.p+i.u(946),i.b)),t=(0,s.Ud)(e),n=new ie,r=(0,s.sj)((function(e){n.acceptMutations(e)})),o=function(e){n.acceptEvents(e)},a=await me();await t.initialize((0,s.sj)(r),(0,s.sj)(o),a.currentSlot),ve=()=>{t[s.Yy]()};const c=new l(n);return{presenters:{bonfire:c.bonfire,environment:c.environment,formatter:c.formatter,player:c.player,resources:c.resources,science:c.science,section:c.sections,society:c.society},interactors:{controller:{start:t.start,stop:t.stop},devTools:{turnDevToolsOn:t.turnDevToolsOn,turnDevToolsOff:t.turnDevToolsOff,setGatherCatnip:t.setGatherCatnip,setTimeAcceleration:t.setTimeAcceleration},dispatcher:{send:t.send},store:{save:t.save}}}}var we=i(698),ye=i(4737);const ke={class:"app-container"},je=(0,r.uE)('<header class="row"><div class="col"><div class="header-start d-flex gap-1 align-items-center"><div>Observable Sorrow</div><div class="badge bg-success"><i class="bi bi-droplet"></i> β </div></div></div><div class="col"><div class="header-middle"></div></div><div class="col"><div class="header-end"></div></div></header>',1),Fe={unscrollable:""},Oe=(0,r._)("div",{class:"loader"},[(0,r._)("div",{class:"spinner-border",role:"status"},[(0,r._)("span",{class:"visually-hidden"},"Loading...")])],-1),Se=(0,r._)("footer",null,[(0,r._)("div",null,[(0,r.Uk)(" Observable Sorrow is a clone of "),(0,r._)("a",{href:"https://kittensgame.com/web/"},"Kittens Game"),(0,r.Uk)(". ")])],-1);var Ee=(0,r.aZ)({setup(e){(0,r.JJ)(ye.y,(0,ye.j)());let t=(0,o.iH)();(0,r.JJ)(we.e,t);const n=(0,r.RC)((async()=>(t.value=await ge(),i.e(0).then(i.bind(i,5e3)))));return(e,t)=>((0,r.wg)(),(0,r.iD)("div",ke,[je,(0,r._)("main",Fe,[((0,r.wg)(),(0,r.j4)(r.n4,null,{default:(0,r.w5)((()=>[(0,r.Wm)((0,o.SU)(n),{class:"w-100 h-100"})])),fallback:(0,r.w5)((()=>[Oe])),_:1}))]),Se]))}});const Te=Ee;var Ce=Te,Ae=i(814);function Ze(e){return e.use(Ae.ZP,{component:"tippy",defaultProps:{animation:"shift-away",theme:"light",arrow:!1,hideOnClick:!1,duration:150,placement:"right-start"}})}var Me=Ze,Ie=JSON.parse('{"game":{"blurb":"You are a kitten in a catnip forest.","control":{"pawse":"Pawse","unpawse":"Unpawse","clear-log":"Clear log","observe-sky":"Observe sky"}},"sections":{"bonfire":{"label":"Bonfire"},"society":{"label":"Society","outpost":"Outpost","small-village":"Small Village","village":"Village"},"science":{"label":"Science"}},"jobs":{"title":"Jobs","status":{"empty":"But nobody came.","good":"Work is going well.","idle":"One is idle. | {idle} are idle."},"woodcutter":{"label":"Woodcutter","description":"Chop some forest trees for wood.","flavor":"Must. Not. Scratch.","effects":{"wood":"Wood production {amount}"}},"farmer":{"label":"Farmer","description":"Cultivate catnip in the surrounding lands.","effects":{"catnip":"Catnip production {amount}"}},"scholar":{"label":"Scholar","description":"Ponder the myriad wonders of the world around you.","effects":{"science":"Science production {amount}"}},"hunter":{"label":"Hunter","description":"Organize an elite force.","effects":{"catpower":"Catpower production {amount}"}},"miner":{"label":"Miner","description":"Dig into the depths of Cath for minerals.","flavor":"How do I hold a pick with my paws…?","effects":{"minerals":"Mineral production {amount}"}}},"management":{"title":"Management","happiness":{"label":"Happiness {amount}","detail":"Happiness affects your workers\' production and consumption of catnip. Rare resources will increase this value whilst overpopulation will reduce it."}},"resources":{"section":{"label":"Resources","empty":"Your paws are empty."},"catnip":{"label":"catnip"},"wood":{"label":"wood"},"minerals":{"label":"minerals"},"science":{"label":"science"},"catpower":{"label":"catpower"},"kittens":{"label":"kittens"}},"environment":{"seasons":{"spring":{"label":"Spring"},"summer":{"label":"Summer"},"autumn":{"label":"Autumn"},"winter":{"label":"Winter"}},"weather":{"warm":"Warm","cold":"Cold"}},"calendar":{"epoch":{"basic":"{season}","full":"Year {year} – {season}"},"basic":{"no-weather":"{season}","weather":"{season} ({weather})"},"full":{"no-weather":"Year {year} – {season}, day {day}","weather":"Year {year} – {season} ({weather}), day {day}"}},"bonfire":{"gather-catnip":{"label":"Gather catnip","description":"Gather some catnip in the forest."},"refine-catnip":{"label":"Refine catnip","description":"Use your mystical kitten powers to convert catnip into wood.","flavor":"So… tired…"}},"effects":{"buildings":{"per-level":"Effects (per level)","total":"Effects (total)"},"jobs":{"per-worker":"Effects (per worker)","total":"Effects (total)"}},"effect-tree":{"base":"Base","bonus":"Bonus","catnip-fields":"Catnip fields","farming":"Farming","happiness":"Happiness","mining":"Mining","overpopulation":"Overpopulation","researching":"Researching","village-demand":"Demand","weather":"Weather","woodcutting":"Woodcutting"},"buildings":{"catnip-field":{"label":"Catnip field","description":"Plant some catnip to grow in the village. Fields have increased production during Spring and decreased production during Winter.","flavor":"‘Nip as far as the eye can see.","effects":{"catnip":"Catnip production {amount}"}},"hut":{"label":"Hut","description":"A simple home with space for 2 kittens. Kittens consume catnip to stay alive.","flavor":"The Nation of Two","effects":{"catpower-limit":"Maximum catpower {amount}","kittens-limit":"Maximum kittens {amount}"}},"library":{"label":"Library","description":"A library to store sacred catkind knowledge. Each level increases science output.","flavor":"All in Catonese","effects":{"science-limit":"Maximum science {amount}","science-ratio":"Science output bonus {amount}","culture-limit":"Maximum culture {amount}"}},"barn":{"label":"Barn","description":"A space to store more of your resources.","flavor":"Rats ain\'t a problem for us!","effects":{"catnip-limit":"Maximum catnip {amount}","wood-limit":"Maximum wood {amount}","minerals-limit":"Maximum minerals {amount}"}},"mine":{"label":"Mine","description":"Allows the acquisition of minerals. Each level increases mineral output.","flavor":"100 days without diggor mortis","effects":{"minerals-ratio":"Minerals output bonus {amount}"}}},"population":{"kitten":{"arrived":"A kitten has joined your village! | {count} kittens have joined your village!","starved":"A kitten starved to death. | {count} kittens starved to death."}},"tech":{"section":{"title":"Technologies"},"calendar":{"label":"Calendar","description":"Develops the ability to predict when the seasons will change. Essential for advanced agriculture.","flavor":"What day is it again?","effect":"Provides a way of more precise time tracking."},"agriculture":{"label":"Agriculture","description":"The basis of all civilised life. Allows the working of land for food.","flavor":"Best thing since sliced bread!","effect":"Unlocks Farmers and Barns."},"archery":{"label":"Archery","description":"Develops the ranged weaponry known as a \'bow\'.","flavor":"Aren\'t cats natural hunters anyway…?","effect":"Unlocks Hunters."},"mining":{"label":"Mining","description":"Develops the ability to extract mineral resources from the bowels fo Cath.","flavor":"Pickaxes are easier to hold with opposable thumbs.","effect":"Unlocks Mines."}},"astronomy":{"rare-event":"A rare astronomical event occurred in the sky.","observed-sky-reward":{"gained":"Observed rare event! Gained {scienceAmount} science!","capped":"Observed rare event! No science, but it was really neat!"},"fallen-meteor-reward":{"gained-minerals":"A meteor fell near the village! Gained {mineralsAmount} minerals!","capped":"A meteor fell near the village! Cool!"}}}'),Pe=i(4940);const qe=(0,Pe.o)({legacy:!1,locale:"en",fallbackLocale:"en",messages:{en:Ie}});function Le(e){return e.use(qe),e}var _e=Le;function xe(){window.__OS_DEVTOOLS__||(window.__OS_DEVTOOLS__=(0,o.qj)({on:!1}))}const Ne=(0,n.ri)(Ce);Me(Ne),_e(Ne),xe(),Ne.mount("#app")}},t={};function i(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=e,function(){var e=[];i.O=function(t,n,r,o){if(!n){var s=1/0;for(u=0;u<e.length;u++){n=e[u][0],r=e[u][1],o=e[u][2];for(var a=!0,l=0;l<n.length;l++)(!1&o||s>=o)&&Object.keys(i.O).every((function(e){return i.O[e](n[l])}))?n.splice(l--,1):(a=!1,o<s&&(s=o));if(a){e.splice(u--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce((function(t,n){return i.f[n](e,t),t}),[]))}}(),function(){i.u=function(e){return"js/"+e+"."+{0:"76edb086",946:"13939c0b"}[e]+".js"}}(),function(){i.miniCssF=function(e){}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="observable-sorrow:";i.l=function(n,r,o,s){if(e[n])e[n].push(r);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+o){a=d;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+o),a.src=n),e[n]=[r];var f=function(t,i){a.onerror=a.onload=null,clearTimeout(p);var r=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((function(e){return e(i)})),t)return t(i)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a.onerror),a.onload=f.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){i.p="/observable-sorrow/"}(),function(){i.b=document.baseURI||self.location.href;var e={143:0};i.f.j=function(t,n){var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise((function(i,n){r=e[t]=[i,n]}));n.push(r[2]=o);var s=i.p+i.u(t),a=new Error,l=function(n){if(i.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,r[1](a)}};i.l(s,l,"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,n){var r,o,s=n[0],a=n[1],l=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(l)var u=l(i)}for(t&&t(n);c<s.length;c++)o=s[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(u)},n=self["webpackChunkobservable_sorrow"]=self["webpackChunkobservable_sorrow"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(1825)}));n=i.O(n)})();
//# sourceMappingURL=app.c35f79ee.js.map